<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>7d - PHP</title>
	<meta name='Generator' content='Zim 0.75.1'>
	<style type='text/css'>
	    @import url('https://fonts.googleapis.com/css2?family=Montserrat&family=Jost&display=swap');
	    :root {
  			--html-background-color: #456;
  			--html-background-color-image: linear-gradient( 0deg, rgba(24,95,240,1) 16.4%, rgba(5,23,111,1) 70% );
  			
  			--main-color: #47b;
  			--main-background-color: #fff;
  			
  			--heading1-color-text: #eeffff;
  			--heading1-background-color: #47b;
  			--heading1-background-image: linear-gradient(to right, var(--main-color), #70bbdd);
  			
  			--code-color-text: #247;
  			
  			--input-background-color: #33a;
  			--input-background-color-hover: #44b

		}

	    html       { /*background-image: linear-gradient(#f2faff,#fff);*/
background-color: var(--html-background-color);
background-image: var(--html-background-color-image);
	    }
	    body       { font-family: 'Jost', 'Noto', 'Arial', 'Sans-serif';
	    				margin:0;
	                 }
	    div#contenido{
	    	margin: 0 auto; padding: 1rem; max-width: 90ch;
	    	background-color: var(--main-background-color);
	    	margin-bottom: 200px;
	    	border-bottom-right-radius: 100px;
			border-bottom: 5px solid darkblue;
			box-shadow: 0px 10px 10px -1px #1e90ff10, 
						  10px 30px 20px -1px #1e90ff40, 
						 -10px 30px 20px -1px #1e90ff40;			
	    }
	    input[type="button"]{
	                 background-color: var(--input-background-color);
                     color: white;
                     border-radius: 5px;
                     border: 3px solid #44b;
                     cursor: pointer;
                     padding: 0.5rem;
                     margin-left: 0.5rem;
                     margin-right: 0.5rem;
                     transition: margin-all 3s ease-in-out 3s;
        }
        input[type="button"]:hover{
	                 background-color: var(--input-background-color-hover);
        }
        input[type="button"]:active {
			  transform: translateY(2px);
			  cursor: progress;
		  }
		a,a:visited  { text-decoration: none;color:blue;      }
		a:hover    { text-decoration: underline; color: dodgerblue; }
		a:active   { text-decoration: underline }
		strike     { color: grey                }
		u          { text-decoration: none;
					 background-color: yellow   }
		tt         { color: var(--code-color-text);
				    	 font-size: large;
		             background-color: rgba(.99, .99, 1, 0.1); 
		           }
		pre        { color: var(--code-color-text);
		             background-color: rgba(.99, .99, 1, 0.1);
					 padding: 20px;
					 font-size: large;
				   }
		div.zim-object pre        {
		             background-color: white;
					 padding: 0px;
				   }				   
		h1         { font-family: 'Montserrat', 'Noto', 'Roboto', 'Arial', 'Sans-serif';
		             text-decoration: none;
					 /*color: #33a;
					 border-bottom: 5px dotted #33a;*/
					 /*margin-top: 2rem; 
					 margin-bottom: 1rem; 
					 
					 border-radius: 5px;
					 padding: 5px;
					 color: var(--heading1-color-text);
					 background-color: var(--heading1-background-color);
					 background-image: var(--heading1-background-image);
					 
					 font-size: xxx-large;*/
					font-family: 'Montserrat', 'Noto', 'Roboto', 'Arial', 'Sans-serif';
					text-decoration: none;
					margin-top: 2rem;
					margin-bottom: 2rem;
					border-radius: 2px;
					padding: 5px;
					color: var(--heading1-color-text);
					background-color: var(--heading1-background-color);
					background-image: linear-gradient(45deg, #0bb,#3fb,#78F);
					font-size: xxx-large;
					position: relative;
					z-index: 1;
					box-shadow: 5px 5px 0px 2px rebeccapurple;
				   }
	h1::before {
		  content: '';
		  position: absolute;
		  background-color: navy;
			transform: skewY(-8deg) rotate(7deg);
			top: -16px;
			left: 0;
			right: 0;
			bottom: 16px;
			z-index: -1; /*detrás del texto, pero delante del fondo */
	  }
		h2         { font-family: 'Montserrat', 'Noto', 'Roboto', 'Arial', 'Sans-serif';
		             color: var(--heading1-background-color); 
		             margin-bottom: 0.5rem;
		             margin-top: 1.5rem;
		             font-size: xx-large;
		             border-bottom: 2px solid var(--heading1-background-color);
		           }
		h3         { 
		             font-family: 'Montserrat', 'Noto', 'Roboto', 'Arial', 'Sans-serif';
		             color: var(--heading1-background-color); 
		             margin-bottom: 0.5rem;
		             margin-top: 1.5rem;
		             font-size: x-large;
		             font-style: italic;
		             margin-left: 0.5rem; 
		           }
		h4         { 
		             font-family: 'Montserrat', 'Noto', 'Roboto', 'Arial', 'Sans-serif';
		             color: var(--heading1-background-color); 
		             margin-bottom: 0.5rem;
		             margin-top: 1.5rem;
		             margin-left: 1rem;
		             filter: brightness(1.1);
		           }
		h5         { 
		             font-family: 'Montserrat', 'Noto', 'Roboto', 'Arial', 'Sans-serif';
		             color: var(--heading1-background-color);  
		             margin-bottom: 0.5rem; 
		             margin-top: 1.5rem;
		             filter: brightness(1.1);
		           }
		p          { margin-top: 0.25rem;  }
		span.zim-tag {
			color: #ce5c00;
		}
		img{
		    scale: 75%;
		    max-width:100%;
		    margin: 0 auto; /* para centrar las imágenes */
			 display: flex; /* para centrar las imágenes */
		}
		img:hover{
		    scale: 100%;
		    max-width:100%;
		}
		div.zim-object {
			border-style:solid;
			border-width:1px;
		}
		form{
            padding: 0.5rem;
            background-color: #125;
            border-radius: 0px;
            text-align: center;
            margin-bottom: 1rem;
		}
		ul{
		    list-style-type: '▪️ '; /*square*/
		}
		div#sumario{
            margin: 0 auto; 
            padding: 1rem; 
            max-width: 90ch;
            background-color: aquamarine; /*greenyellow;/*moccasin;*/
/*            background-image: radial-gradient( circle farthest-corner at 10% 20%,  rgba(166,239,253,1) 0%, rgba(97,186,255,1) 90.1% );
*/
				background-position:bottom;
				background-repeat: no-repeat;
				background-image: url('data:image/svg+xml, <svg preserveAspectRatio="none" viewBox="0 0 1200 120" xmlns="http://www.w3.org/2000/svg" style="fill: %23ffffff; width: 100%; height: 180px; transform: rotate(180deg);" ><path d="M321.39 56.44c58-10.79 114.16-30.13 172-41.86 82.39-16.72 168.19-17.73 250.45-.39C823.78 31 906.67 72 985.66 92.83c70.05 18.48 146.53 26.09 214.34 3V0H0v27.35a600.21 600.21 0 00321.39 29.09z" /></svg>');

            /*border-radius: 0px;*/
            border-top-right-radius: 152px;
		}
		div#sumario a {
			color:#0000dd;
		}
		div#sumario h1{
			margin-right: 300px;
			text-align: center;
			box-shadow: 5px 5px 0px 2px white;
		}
		div#volver{
		    position: fixed;
            right: 0.5rem;
            bottom: 0.5rem;
            padding: 0.5rem;
            border: 3px solid #7af;
            border-radius: 50%;
		}
		div#volver:hover {
			filter: brightness(1.2) saturate(1.2);
		}
		div#pie{
			min-height: 200px; 
			/*background-color: #47b;*/
			color: #cef;
			display: flex; 
			justify-content: center; 
			align-items: center; 
			position: fixed; 
			bottom:0; left:0; right: 0;
			z-index: -1;
			background-image: linear-gradient( 0deg, rgba(0,0,0,0.6) 0%, rgba(255,255,255,0) 100% );
			font-size: larger;
			text-align:center;
		}
		div#pie a{
			color: deepskyblue;
		}
		pre.codigo{
			border: 1px solid blue;
			padding: 5px;
			background-color: aliceblue;
			border-radius: 5px;
		}
		
		div.codigoresultado{
			background-color: #469;
			color: whitesmoke;
			padding: 5px;
			border-radius: 5px;
		}
		.checked-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB9gKGQ8sMEGsKGkAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAEBUlEQVRIx62V22tdRRTGf7Nn73P2ybntnNOe3NqkPTGgLTVUUZF6QatSLOKTPgqCIqLgQ0H/A1sQQbBYCBb1QfAxiC8tSO1FqHkwJVKtjdTGNraUmObsc9nXmfGh7cGYpM1D5nHWzPetteZb3wg2eB2YqYm4zSadsMtoboiNBH/3TE0awx6j+MRoxoTg/IYRvP19TQrJS0bzhdHGSyKFkLTtjSKwMjyiEz43ynhtP6bdjBCWyFobAf7eT7VhNF/q1FRbjYjmUohlCVPwnB+6FUxMTJipqSmUUhhjEGKd3bMT4ks/Y6oLBK2Yth8hHYtCJXOix7Nf7xLMzc0xOzvLzp078TyPNE3viW3QJPXzhNWbxFFKHCmMhoLn/FHodd48vGfhapdAacXQlkFK5dL6wIUm6fuTZPuvqDQhaMUYYyiVyuQr6rXDexYuAdi3tSv1ZJNs/R/CaszzT+1na88uXFnCEnJVgivBNN8uTJKmHQI/ptOOcXNZzMz9mOqFs90OHpipWcYwlo5P4ebnuOkrvr5wgrH+h3im7y36MzuwRXYZeKha/OhP0EkadFoxQSdGSotedR/+XwMc2XvKdNUFOFqZx6LKZWIiwjgkikNmLp/hm8sH+K1zjFTHXfBYdTi+eJArzXM0GxFxoBDCopLvo/fqEwi1XPkWkGqjFo2TgB1jOYZUKZTS/D1/ncmLh7jon0IbRWoiTi59ymzzJEEQE3cStNZsGxqlfPE57MBbOR8fP3hDGalOO9fq2DlBvmZw8xa2IxACGn6TydlD/O6f5OzSV/zif0cYhLQaEXGkKBbz7Ov/AOlXV1cxgBJRI3fuSTrpTawt18kWIZN1CFuaONI0w0WOXfsI43YIggh/KUSlhqxrMz74AkOZcWBm9QkH+Gw8NDLuITi+m0yzhluSyJzBLcpblUhFxywSRAEtPwQjsKVN30CNh0uvYuOubSHLtN3J0TO1j0pmBNuFbFWRK0gyPRZpktL2I5JQkclKakNlnh54g6ocvevUr/Ai2a7wineEkcJupA3S1Wg0nVZM2E6wbEF5U5G9Q++wI7sfR7h3N8HVNstykBfzH+KJEZwiWD0aIwxCgJ0R1Mu7GXOeJSuK93bZtQIle4D9pUNU5DC5jEsu55AvZakM5NicGyEj8uuz8bUCQgj67QfY671P3vEoeC69gy695U1U7NG7XV0pUwBjDJa1/JJlWWxzHuflzQe5FJ/GsgUVuZ2t8lEkTvfc0aNHb72flBhjVicQQqCUuvM3/M+WDVguWBrMVdDXEGZlBVEUrVCU9d9s5+fnaTQa2PZyPxEIhJaI1EEoZwX4ncynp6fXrmB4eJjR0VFarRbNZnP9P9rt9gohqNVq1Ov1ZbF/AZGev3hLJ2/zAAAAAElFTkSuQmCC)}
		.xchecked-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB9gKGQ8bDYnDxEwAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAEK0lEQVRIx9WVS2hTWRjHf/eR3CY1nbxMH2YiZRQS6qO13YlMVxY3SnVcuNIBFezGpSADLoQqLu1sHJCqdCFSXFpw4YOCSH3BtFqttTNamabX3DS5bfO6uffMoglja3RGcDMHzuac7/z/53++//cd+L8P6VuCPQYZ8ADNgBd4J31DcDcQs+GnHByRocEDv0kfBSjAOlYCs11Q+gpwDegS8LMJ+3QIK0ATzEhV8Odnz5bzw8P4dJ25aJQ/WlvJ1df/K7hSLtOcTNI+Pk69rpMTgqIQhCDvh1/VSpw79+gRrRMTmLZNezLJJsPg+a5dmOEwQlFqg1sWG16/Jv7sGWXDwBACFQjC9HcwIMONKkGp4PGAJGEDS0IQmZlhnWnye3c3eiyGo6qr3WHbrJ+dJf7gAXI6zSIr72T7/fgzmT4FHnTBsgrQBfYvTU0km5vxz86iADnAm0rRPTWFt7cXZccOJJcLAGHb2K9ekT93jmwmwwdAAFpjI6Ntbfxw5879ag7l6o1sr5eHHR3IsRgeQK/M4sQE+YEB7JcvEY6zAj45SWFgAPPxYwzHoQxIkQjTPT0kIxE+Noj8sexFn4/xnh58iQTeSpHkHAdrbIzi0BCOrmNPTpK/eJHM3bt8sCyKQCiR4NWePWSiUZw1+ZLXJm4pFKLhzBlCsRh2RUXacVgeGaF47RrL58+zcP8+RrmMkCQinZ1EL1zAjERqmkH+tLYl1G3bCJw4QUjT0IA0MJfLMX/5MqmHD0nZNiUgtGULG/r7ccXjINWuWbnmqsuFu7sb/4EDNLlcBIEioNs2KUAFGmMxmk6dQm1tRZI+3xBqEkiShBQOox05Ql1nJ26gvuIUAWiKQnj/ftStW5Fk+YuF+NldsbBA4cYN9KdPmaso8Fc62ZJtk7l1C2t0FGdxESHE1xE4hkHh6lX0oSHSpRIewC/LrPf7CSgKNpCamkI/fZr8pUuIZBIcpyaBunahPp1mub+fDyMjGKUSChCsq6Nh717q9u2jbnSU0uAgRrFIwTThyhUCqRS+hgZKLS1fJvDm87SNjZGcnsYUAjcQ8vsJ9/Xh7u1FDgRQN20iks3iDA+zZFmYhQLqzZtsj8WY3L0baY2Sf55ICCKpFHUzM2SEQAJCHg+hY8fQDh5EDgRWDoRC1J88SePRo2geD0XAcBy8b98Sv3ePYDZbbf2rFQjLIphMsmDbaEBQVQkePox26BCSz7e6i4bDrDt+nGYhmBscpFAskheC4Js3bPR4qHphFYEnlcI7P4/jdqNpGu8TCe4oCsXr1z//F2ga3+/cSfTJE0qmSVYIsKzaOZDcbjKyzFIiwfvt21kMBLA07YsetzWNd+3tLLW0sH5igvT8PH9Go/z44kX+E4LGjg7GDYOcy4XlOEgLC//5P/5LCFzxOPLmzWyIx+m6fduu7v0NVGqyTSycKksAAAAASUVORK5CYII=)}
		.unchecked-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB9gKGQ8qAt8h3m8AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAA60lEQVRIx+2VsQqDMBRF70sCLg5OLoKgjk7+lJ/hh+STXBwcnRz8ArMEkrxOFktbaC3tULzTg5e8k5vADXDq70VbobXmvu/hvQczg4heHrJfXxQFuq67blZbMc8zpmlCXddIkgTOuZcBUko45zCOI6y1Nz2xFSEEZFmGOI7fGg4A3nsQEZqmuXOu9jallACAtm3fvmutNaIoAjM/dkBECCF89KCbk4eAb+kEnIAT8EsAM0OIz3hSyrssUvss8t5fg+uIrLXPs0gIgWVZYIyBUurQyYdheO4gz3NUVQVjDNZ1PfSjpWmKsixvehfB9GBZ3NndrgAAAABJRU5ErkJggg==)}
		.migrated-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB+AKHREFA8vJSnkAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAC1klEQVRIx+2VT0hUURTGf/e958w4Tc3TYowMw1GyEgwr1MqsFmbZIrIWQZsWJUjbdoHQpl3Qps0swnCRECQFYkR/TC1iKkqmfzAKTo2Vf8hoRsfR995tkRMT87RRWkUHHhy495zvnvvu933wP/75EKkkEAjIYDCIaZpIKRFCZN0kfX9xcTGtra2/irVUEolECIfDlJeXo+s6hmFkDaCqKoZhEAqFSCaTv60pqcSyLAoLC/F4PEtqDmCaJkIIKisrMybX0sdUVRWA5ubmPzdNjjI1cpXkZC/O1fV03PXgdDqRUtpPIITAsqxsDz0Z/3CZQv8uqo4N4C8/Tp2/DdM0MiZQlvk41OTkI/LW1SGtCVb5drD3eCc71wcA+VcAHA5vDd8+3UGakxiJV7i9pdQevU5T1R35pJ3MV5QW1pf+0kWBheJ2SWua8EQXZXsu4fVVYEz1sEKvof5EuxjoPvzpcRvrdp9C2gGMx6cpOHBmbImMesds7BZubwMVDTfXDnQ3vQfK7AC8wLfExMX5whyQc3q2OEnjGm5vE76SQxsfBLr77a7CNf+n0r/l6sSMtsBSnurckiIILCobAtVZhpF4gZF4jubaymj4Ch/fd380LE7bAnjc0NPxk2yqpmEuwGxF0ag+0k5uTpzZeBeaazvj0We8fXojainsb2xh2BZgbe0gSIllzSIUh63wfQ6dZ/O2fbjcKlOj58jJ3cVENESw5yErc9nf2MLQ4jwQAkV1Lqiq37/cZ9WaahJjF9AcmxiPDhLs7ePe23oOnmUwg2hSShQle96tKDjA2HAniusgo9FxnvY9Jxw7RWzGYy92QghM00x5g53qp9sHmtB58/o2umOI2NwGolMnMYUHIb7aAyiKwsjICLqu2/qBEIKUUAohMaSHSLyBSMoPTINQ6CX5+fn2AEVFRZSUlBCPx4nFYhl3L4RESjF/GEgX3pSj+Xw+/H7/b3U/AEOZFnp7O5+5AAAAAElFTkSuQmCC)}
		ul {list-style-image: none}
		/* ul rule needed to reset style for sub-bullets */
	</style>
	
	<!-- resaltado de sintaxis -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
	<!-- and it's easy to individually load additional languages -->
	<!-- script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/php.min.js"></script -->


</head>
<body>
    <form>
    <input type="button" id="btnAmpliar" value="Ampliar margen">
    <input type="button" id="btnReducir" value="Reducir margen">
    <input type="button" id="btnSumario" value="Ver/ocultar sumario">
    </form>


<div id="sumario" style="display:none">
<h1>Sumario</h1>
<!-- Sumario --> 
            <a href="#h1">7d - PHP</a> <br>
            <a href="#h2">Creación del árbol del proyecto</a> <br>
            <a href="#h3">Preparando el entorno con Docker</a> <br>
            &nbsp; &nbsp; <a href="#h4">Opcional: Hacer que se nos muestre el contenido del directorio actual</a> <br>
            &nbsp; &nbsp; <a href="#h5">Opcional: Mostrar información por la consola</a> <br>
				&nbsp; &nbsp; &nbsp; &nbsp; Usando la consola del navegador <br>
        <!-- ocultamos el contenido entre ocultar y finocultar -->
				&nbsp; &nbsp; &nbsp; &nbsp; Usando la consola en el servidor <br>
        <!-- ocultamos el contenido entre ocultar y finocultar -->
            &nbsp; &nbsp; <a href="#h8">Opcional: htmlspecialchars</a> <br>
            &nbsp; &nbsp; <a href="#h9">Opcional: Patrón de diseño a utilizar</a> <br>
            &nbsp; &nbsp; <a href="#h10">Ejercicios</a> <br>
            <a href="#h11">Conexión a la base de datos</a> <br>
            &nbsp; &nbsp; <a href="#h12">Crear una tabla ejecutando una consulta</a> <br>
            &nbsp; &nbsp; <a href="#h13">Ejecutar una consulta de eliminación, inserción o actualización</a> <br>
				&nbsp; &nbsp; &nbsp; &nbsp; Consultas con parámetros <br>
        <!-- ocultamos el contenido entre ocultar y finocultar -->
            &nbsp; &nbsp; <a href="#h15">Ejecutar una consulta de selección</a> <br>
				&nbsp; &nbsp; &nbsp; &nbsp; Limitando las consultas de selección <br>
        <!-- ocultamos el contenido entre ocultar y finocultar -->
            &nbsp; &nbsp; <a href="#h17">Ejercicios</a> <br>
</div>
<!-- Sumario -->


<div id="contenido">

<!-- contenido -->
			<h1 id="h1">7d - PHP</h1>
			<p>
Para crear el servidor, vamos a utilizar Docker. Concretamente una imagen oficial que incluye PHP con Apache ya configurado.
</p>
<br>
<p>
La alternativa sería instalar Apache y PHP manualmente y configurarlo para que funcionen juntos.
</p>
<br>

			<h1 id="h2">Creación del árbol del proyecto</h1>
			<p>
Crea un directorio que sea el directorio principal de tu proyecto, a partir de ahora todo lo haremos dentro de ese directorio. 
</p>
<br>
<p>
<b>Nota</b>: Elige uno que no sea el escritorio o tu carpeta personal. 
</p>
<br>
<p>
Por ejemplo:
</p>
<pre>
mkdir appcliente
cd appcliente
</pre>
<br>
<p>
Crea los siguientes directorios y ficheros. Asegúrate de que el directorio <tt>basedatos</tt> y el fichero  <tt>bd.sqlite</tt> pertenecen al usuario <tt>www-data</tt> y al grupo <tt>www-data</tt>).
</p>
<br>
<pre>
.
├── index.php
├── php/
│    └── servidor.php
├── public/
│	    ├── css/
│	    └── js/
└── basedatos/
	    └── bd.sqlite
</pre>
<br>
<p>
Se puede crear rápidamente ejecutando estas órdenes:
</p>
<pre>
mkdir -p php public/css public/js basedatos
touch index.php php/servidor.php basedatos/bd.sqlite
sudo chown www-data:www-data basedatos basedatos/bd.sqlite 
</pre>
<br>
<p>
Para probar, modifica el fichero <tt>index.php</tt> para que tenga este contenido:
</p>
<pre>
&lt;h1&gt;Hola caracola&lt;/h1&gt;
&lt;?php phpinfo() ?&gt;
</pre>
<br>
<br>

			<h1 id="h3">Preparando el entorno con Docker</h1>
			<p>
Para arrancar una imagen oficial de PHP que ya viene con el servidor web instalado.
</p>
<pre>
docker run -d -p 80:80 --name appcliente -v "$PWD":/var/www/html php:8.3-apache
</pre>
<br>
<p>
<b>Nota</b>: si el puerto <tt>80</tt> ya lo tienes ocupado en tu equipo, cámbialo. Por ejemplo, si quieres usar el puerto 1234,
</p>
<pre>
docker run -d -p 1234:80 --name appcliente -v "$PWD":/var/www/html php:8.3-apache
</pre>
<br>
<p>
Si todo ha ido bien, accediendo al navegador <a href="http://localhost" title="http://localhost" class="http">http://localhost</a> verás que se cargará el encabezado seguido la página de información de PHP.
</p>
<br>
<br>

			<h2 id="h4">Opcional: Hacer que se nos muestre el contenido del directorio actual</h2>
			<p>
Esta parte es opcional, simplemente es una muestra de cómo podemos cambiar la configuración del apache dentro del contenedor, de hecho es posible que no sea recomendable para evitar problemas de seguridad.
</p>
<br>
<p>
Por defecto no se nos mostrará el contenido del directorio actual al ejecutar el contenedor, para ello tenemos que modificar el fichero que se encuentra en <tt>/etc/apache2/conf-available/docker-php.conf</tt> dentro del contenedor. 
</p>
<br>
<p>
Lo más sencillo será copiar el fichero con la configuración original, modificarlo, copiar el fichero modificado y recargar la configuración del apache. Supongamos que el contenedor se llama <tt>appcliente</tt>
</p>
<br>
<p>
1- Copiamos el fichero del contenedor al directorio actual
</p>
<pre>
docker cp appcliente:/etc/apache2/conf-available/docker-php.conf .
</pre>
<br>
<p>
2- Modificamos el fichero<br>
La parte que nos interesa es la que tiene un <tt>Options -Indexes</tt>, que hay que cambiarlo por:<br>
<tt>Options Indexes</tt>
</p>
<br>
<p>
3- Volvemos a copiarlo dentro del contenedor
</p>
<pre>
docker cp docker-php.conf appcliente:/etc/apache2/conf-available/docker-php.conf
</pre>
<br>
<p>
4- Recargamos el apache del contenedor
</p>
<pre>
docker exec appcliente service apache2 reload
</pre>
<br>
<p>
<b>Nota</b>: sólo aparecen los ficheros y directorios que apache pueda leer. <br>
Los directorios tendrán que tener permisos de <tt>r</tt> y <tt>x</tt> (lectura y ejecución). Para cambiar los permisos de todos los directorios bajo el directorio actual podemos ejecutar lo siguiente en el contenedor: <tt>for i in */; do chmod a+rx "$i" ; done</tt><br>
Usando <tt>-R</tt> en el <tt>chmod</tt> lo haremos recursivo.
</p>
<br>
<br>

			<h2 id="h5">Opcional: Mostrar información por la consola</h2>
			<p>
Hay dos maneras de mostrar información de una manera cómoda. La primera es a través de la propia consola del navegador y la segunda a través de la consola del contenedor.
</p>
<br>

            
				<h3>Usando la consola del navegador<a id="usando-la-consola-del-navegador" class="h_anchor"></a></h3>
<p>
Basta con ejecutar donde lo necesitemos un trozo de código javascript que escriba en la consola:
</p>
<pre>
echo("&lt;script&gt;console.log('PHP: Hola caracola')&lt;/script&gt;");
</pre>
<br>
 <br>
            
				<h3>Usando la consola en el servidor<a id="usando-la-consola-en-el-servidor" class="h_anchor"></a></h3>
<p>
Para que sea el servidor el que nos muestre el mensaje, podemos usar la función error_log(). Por ejemplo:
</p>
<pre>
error_log("Hola caracola");
</pre>
<br>
<p>
El problema es que si queremos ver esa información únicamente tendremos que filtrar la información que obtengamos (por defecto todo lo que se registra en Apache pasa al fichero de logs). Suponiendo que el contenedor se llame hlcdam, podemos hacerlo así:
</p>
<pre>
docker logs appcliente | grep php:notice
</pre>
<br>
<br>
 <br>
			<h2 id="h8">Opcional: htmlspecialchars</h2>
			<p>
Cuando vayamos a escribir código HTML usando datos recibidos desde el cliente es una buena práctica utilizar la función <tt>htmlspecialchars()</tt> que convertirá los caracteres potencialmente complicados (como por ejemplo los acentos o los símbolos de mayor y menor) a las entidades correspondientes (por ejemplo <tt>&amp;iacute;</tt> o <tt>&amp;lt;</tt>).
</p>
<br>
<pre>
$nombre = $_GET['txtNombre'];
&lt;p&gt;Hola &lt;?php echo htmlspecialchars($nombre) ?&gt;&lt;/p&gt;
</pre>
<br>
<br>

			<h2 id="h9">Opcional: Patrón de diseño a utilizar</h2>
			<p>
Para intentar ahorrarnos problemas, podemos usar este patrón:
</p>
<pre>
$nombre_usuario = trim($_POST['nombre_usuario'] ?? '');
</pre>
<br>
<p>
Lo que hace es intentar recuperar el dato que nombre_usuario que se ha pasado por el método POST desde el cliente. Si no se mandó ese dato, el operador <tt>??</tt> (<i>Null Coalescing Operator</i>) hará que se use la cadena vacía (<tt>’’</tt>) como valor. En cualquiera de los dos casos, se eliminarán los espacios en blanco que tenga la cadena de caracteres resultante por delante y por detrás.
</p>
<br>
<p>
Por ejemplo: si se manda desde el cliente <tt>"  Javier    "</tt>, la variable <tt>$nombre_usuario</tt> contendrá <tt>"Javier"</tt>. Si no se manda nada, contendrá <tt>‘‘</tt>.
</p>
<br>
<p>
<b>Nota</b>: las comillas simples en la explicación de arriba han sido sustituidas por <tt>’</tt> por legibilidad. Cuidado al hacer copy&amp;paste.
</p>
<br>
<br>
<br>

			<h2 id="h10">Ejercicios</h2>
			<p>
<b>Ejercicio 1</b>: Partiendo del árbol de directorios del proyecto, crea una aplicación que contenga un formulario con un cuadro de texto y un botón con la etiqueta <i>Enviar datos</i>.
</p>
<br>
<p>
Cuando se pulse el botón, se mandará una petición AJAX usando GET para obtener la respuesta del fichero <tt>responderGritando.php</tt>. Este fichero devolverá el mensaje <tt>"Hola caracola"</tt> que se mostrará en una párrafo de la web.
</p>
<br>
<p>
<b>Ejercicio 1b:</b> <br>
Modifica el ejercicio de manera que cuando se pulse el botón, se mandará el contenido del cuadro de texto al servidor, concretamente al archivo <tt>responderGritando.php</tt>, mediante una llamada AJAX usando el método GET.<br>
El servidor  responderá con el mismo texo que recibión, pero en mayúsculas y se mostrará en un párrafo de la web.
</p>
<br>
<br>
<br>
<br>
<br>

			<h1 id="h11">Conexión a la base de datos</h1>
			<p>
Vamos a crear un fichero de configuración con funciones y estructuras comunes, este fichero se creará dentro del directorio <tt>php/</tt> y se llamará <tt>config.php</tt>.
</p>
<br>
<p>
Usaremos el siguiente código cuando vayamos a conectarnos a una base de datos MySQL:
</p>
<pre>
$conexion = new PDO( "mysql:host=$ip;dbname=$db",  $usuario,  $contraseña );
</pre>
<br>
<p>
También podemos indicar la codificación de caracteres:
</p>
<pre>
$conexion = new PDO( 'mysql:host=localhost;dbname=tareas;charset=utf8',  "root",  "root" );
</pre>
<br>
<p>
El código para una base de datos SQLite es aún más simple al no tener que indicar ni dirección ip, ni usuarios ni contraseñas.
</p>
<pre>
$conexion = new PDO( "sqlite:basedatos.db" );
</pre>
<br>
<br>
<p>
Lo que haremos será crear una función en el fichero <tt>config.php</tt> que nos permita realizar la conexión al fichero que contiene la base de datos.
</p>
<pre>
function conectarBaseDatos( ){
  $doc_root = $_SERVER["DOCUMENT_ROOT"];
  $rutabd = $doc_root . "/basedatos/bd.sqlite";

  try {
    $conexion = new PDO("sqlite:".$rutabd);
  } catch (PDOException $e) {
    responderError( "No se ha podido establecer conexión con el servidor de bases de datos. \n " . $e-&gt;getMessage() );
    die ("Error: " . $e-&gt;getMessage());
  }

  return $conexion;
}
</pre>
<br>
<br>
<p>
Ahora podremos usar la conexión para realizar las consultas que deseemos. Por ejemplo, para crear una tabla.
</p>
<br>
<p>
<b>Importante</b>: recuerda que si un fichero sólo contiene código PHP debemos incluir el <tt>&lt;?php</tt>, pero no el <tt>?&gt;</tt> para evitar que se manden las nuevas cabeceras (por ejemplo si queremos hacer una redirección <tt>header('Location: ./inicio.php');</tt>, nos dará problemas porque ya fueron mandadas las cabeceras).
</p>
<br>
<p>
Además añadiremos un par de funciones para responder desde el servidor. El fichero <tt>config.php</tt> completo quedará así.
</p>
<pre>
&lt;?php

function conectarBaseDatos( ){
  $doc_root = $_SERVER["DOCUMENT_ROOT"];
  $rutabd = $doc_root . "/basedatos/bd.sqlite";

  try {
    $conexion = new PDO("sqlite:".$rutabd);
  } catch (PDOException $e) {
    responderError( "No se ha podido establecer conexión con el servidor de bases de datos. \n " . $e-&gt;getMessage() );
    die ("Error: " . $e-&gt;getMessage());
  }

  return $conexion;
}

/* Respuesta con error 500 */
function responderError( $datos, $codigo=123 ){
  header('HTTP/1.1 500 Internal Server Error');
  header('Content-Type: application/json; charset=UTF-8');
  die(json_encode(['message' =&gt; $datos, 'code' =&gt; $codigo]));
}

/* Respuesta correcta */
function responder( $datos ){
  echo json_encode($datos);
  exit(0);
}

/* ERROR REPORTING */
//Indica que sólo se mostrarán errores, no Warnings ni otros errores. 
//Valores posibles: E_ERROR | E_WARNING | E_PARSE | E_NOTICE
error_reporting(E_ERROR);
</pre>
<br>
<br>
<br>

			<h2 id="h12">Crear una tabla ejecutando una consulta</h2>
			<p>
Para ejecutar consultas podemos usar una plantilla que tendremos que modificar para adaptarla a nuestras necesidades. Como ejemplo, vamos a crear una tabla en el fichero de base de datos que creamos en el anterior ejercicio. Si no tienes creado el árbol de proyecto, hazlo ahora. 
</p>
<br>
<p>
Ahora podemos crear una tabla ejecutando este código en el servidor (el fichero podría llamarse <tt>crearTabla.php</tt>):
</p>
<pre>
&lt;?php
require( 'config.php');

// Creamos la conexión al servidor
$conexion = conectarBaseDatos();

// Recuperamos los parámetros de la petición
// $nombreTarea = $_POST["nombreTarea"];

$sql = "CREATE TABLE tareas (
	id INTEGER PRIMARY KEY AUTOINCREMENT, 
	nombre TEXT, 
	prioridad INTEGER DEFAULT 0
	);" ;

try{
	$resultado = $conexion-&gt;exec( $sql ); //Consultas de inserción, eliminación y actualización con exec. Selección con query
}catch(Exception $e){
	$resultado = null;
	$conexion = null;
	responderError( "Error al crear la tabla TAREAS. " . $e-&gt;getMessage());
	exit(0);
}

//cerramos la conexión
$resultado = null;
$conexion = null;

//mandamos la respuesta
responder("Tabla TAREAS creada con éxito.");
</pre>
<br>
<br>
<br>

			<h2 id="h13">Ejecutar una consulta de eliminación, inserción o actualización</h2>
			<p>
Las operaciones de inserción, borrado o actualización de datos sobre una tabla se realiza mediante <tt>exec()</tt>.
</p>
<br>
<pre>
$sql = "insert into tareas(nombre,completada) values ('Subir el Everest', 0)" ;
$resultado = $conexion-&gt;exec( $sql );
</pre>
<br>
<p>
Esa consulta es perfectamente válida porque los datos que vamos a insertar los estamos indicando nosotros manualmente. Sin embargo, si los datos que vamos a insertar provienen de datos escritos por un usuario malicioso, <b>hay que intentar prevenir los ataques de SQL injection</b>. Para ello, podemos usar consultas con parámetros.
</p>
<br>
<br>

            
				<h3>Consultas con parámetros<a id="consultas-con-parámetros" class="h_anchor"></a></h3>
<br>
<p>
Este tipo de consultas tiene la ventaja de que se pueden repetir en el tiempo, haciendo que la base de datos y el <i>driver</i> de conexión de PHP puedan cachear la consulta y hacer la ejecución más eficiente. Estas consultas preparadas se ejecutarán con <tt>execute()</tt>.
</p>
<br>
<p>
Código de ejemplo:
</p>
<pre>
$id = $_GET['id'];
$resultado = $conexion-&gt;prepare("SELECT * FROM tareas WHERE id&gt;=:id");
$resultado-&gt;execute([':id' =&gt; $id]);
</pre>
<br>
<br>
 <br>
			<h2 id="h15">Ejecutar una consulta de selección</h2>
			<p>
Las consultas de selección se hacen con el método <tt>query()</tt>, aunque al igual que con las anteriores habría que usar parámetros en las consultas para evitar ataques de inyección de SQL. 
</p>
<br>
<p>
Ejemplo de código con <tt>query()</tt>:
</p>
<pre>
$resultado = $conexion-&gt;query("SELECT * FROM tareas");

while ( $tarea = $resultado-&gt;fetchObject() ) {
	echo "&lt;p&gt;", $tarea-&gt;id ,": ", $tarea-&gt;nombre, " (", $tarea-&gt;prioridad ,")&lt;/p&gt;";
}
</pre>
<br>
<p>
En lugar de <tt>$resultado-&gt;fetchObject()</tt> podemos usar <tt>$resultado-&gt;fetch()</tt> que devolverá una tarea (una fila de la consulta) como un array asociativo.
</p>
<br>
<p>
<b>Nota</b>: También se puede, directamente, <tt>fetchAll()</tt> para recuperar todas las filas resultado de realizar la consulta.
</p>
<br>
<p>
Otra manera de hacerlo, en esta ocasión usando <tt>fetchAll()</tt>:
</p>
<pre>
$resultados = $resultado-&gt;fetchAll(); //devuelve un array

echo "&lt;p&gt;Hay un total de ",count($resultados)," tareas en la base de datos.&lt;/p&gt;";

foreach ($resultados as $tarea) {
	echo "&lt;p&gt;", $tarea['id'] ,": ", $tarea['nombre'], " (", $tarea['prioridad'] ,")&lt;/p&gt;";
}
</pre>
<br>
<p>
Salvo que indiquemos lo contrario, PHP por defecto se trae de la base de datos todas las filas de una vez, pero podemos procesarlas de una en una (<tt>fetchObject</tt>) o en un array asociativo (<tt>fetchAll</tt>).
</p>
<br>
<p>
Con el <tt>fetchAll()</tt> podemos contar las filas con un <tt>count( ... )</tt>. Sin embargo con el fetch tendremos que usar en un contador en el bucle.
</p>
<br>
<br>
<p>
Lo más cómodo para nosotros, si queremos mandar de vuelta todas las filas, será mandarlas todas de vuelta.<br>
<tt>responder($resultado-&gt;fetchAll()); //los manda todos de vuelta</tt>
</p>
<br>
<br>

            
				<h3>Limitando las consultas de selección<a id="limitando-las-consultas-de-selección" class="h_anchor"></a></h3>
<br>
<p>
Podemos limitar el número de registros obtenidos de las consultas selección usando las <tt>LIMIT</tt> y el <tt>OFFSET</tt> en la propia consulta.
</p>
<br>
<p>
Para limitar los resultados de la consulta, vamos a hacer uso de las palabras reservadas <tt>LIMIT</tt> y <tt>OFFSET</tt> de SQL y así podremos paginar los resultados. Podemos usarlos de la siguiente manera:
</p>
<br>
<pre>
SELECT * FROM tareas
LIMIT 10 OFFSET 30;
</pre>
<br>
<ul style='padding-left: 30pt'>
<li><tt>LIMIT</tt> indica cuántos resultados como máximo se devolverán en la consulta, en el caso de arriba se devolverán 10.</li>
<li><tt>OFFSET</tt> (que significa desplazamiento) indica cuántos elementos se ignorarán antes de empezar a devolverlos, en este caso 30.</li>
</ul>
<br>
<p>
De este modo nos devolverá los resultados que ocupen una posición entre la 31 y la 40 (10 resultados).
</p>
<br>
<br>
<br>
 <br>
			<h2 id="h17">Ejercicios</h2>
			<p>
<b>Ejercicio 2</b>: Partiendo del árbol de directorios del proyecto, crea una aplicación que muestre un formulario con un botón <i>Crear tabla</i>. Cuando se pulse, se realizará una llamada AJAX que se recogerá en el servidor, donde se creará una tabla en el fichero <tt>bd.sqlite</tt> ejecutando esta consulta:
</p>
<pre>
CREATE TABLE tareas (
	id INTEGER PRIMARY KEY AUTOINCREMENT, 
	nombre TEXT, 
	prioridad INTEGER DEFAULT 0
	);
</pre>
<br>
<p>
<b>Ejercicio 3</b>: Ahora que tienes la tabla <tt>tareas</tt> creada, termina la aplicación de manera que se pueda añadir una nueva tarea, eliminar una tarea y listar una tarea.<br>
Si quieres complétalo para que también permita modificar una tarea.
</p>
<br>
<p>
<b>Ejercicio 4</b>: Crea un nuevo proyecto usando el mismo árbol de proyecto y usa de nuevo docker.
</p>
<br>
<p>
Para no partir de una base de datos vacía, vamos a instalar el programa sqlite3 y a cargar los datos contenidos en el fichero <tt>pelis.sql</tt> en la base de datos.
</p>
<pre>
docker exec -it appcliente apt update
docker exec -it appcliente apt install -y sqlite3
docker exec -it appcliente bash -c "cat pelis.sql | sqlite3 basedatos/bd.sqlite"
</pre>
<br>
<p>
Ejemplo de una sentencia SQL:
</p>
<pre>
select * from peliculas, tipos_peli where peliculas.peli_tipo = tipos_peli.tipo_id;
</pre>
<br>
<p>
Crea una aplicación que haga lo siguiente:
</p>
<ul style='padding-left: 30pt'>
<li>Al pulsar el botón, se mostrará un listado con el contenido de la tabla <tt>gente</tt>, indicando si es un actor o un director. Al pulsar sobre un director se nos mostrará un listado de las películas que ha dirigido, si es un actor se nos mostrará un listado con las películas que ha protagonizado.</li>
<li>Automáticamente al arrancar cargará en un <tt>&lt;select&gt;</tt> los tipos de película que aparecen en la tabla <tt>tipos_peli</tt>. </li>
<li>al seleccionar un tipo de película en el <tt>&lt;select&gt;</tt>, se mostrará el listado de películas de ese género. Se mostrará el nombre de la película y el año.</li>
<li>en ese listado al pulsar sobre una película se nos mostrará el nombre del director principal y el nombre del director.</li>
</ul>
<br>
<br>





<!-- Wiki content -->

<!--
Lo separo con espacios entre el [ y el % para que no genere de nuevo el contenido
[ % FOR page IN pages % ]
	[ % page.content % ]
[ % END % ]
-->
<!-- End wiki content -->

</div>

<div id="volver">
    <a href="#">⬆️</a>
</div>

    <script defer>
    let ancho=90;
    btnAmpliar.addEventListener('click', e=>{
        ancho+=12;
        document.querySelector("#contenido").style.maxWidth = ancho+'ch';
        document.querySelector("#sumario").style.maxWidth = ancho+'ch';
    });
    btnReducir.addEventListener('click', e=>{
        ancho-=12;
        document.querySelector("#contenido").style.maxWidth = ancho+'ch';
        document.querySelector("#sumario").style.maxWidth = ancho+'ch';
    });
    
    let sumarioOculto = true;
    btnSumario.addEventListener('click', e=>{
        sumarioOculto = !sumarioOculto;
        if(sumarioOculto)document.querySelector("#sumario").style.display='none';
        else document.querySelector("#sumario").style.display='block'
    });
    
    
    //Resaltado de sintaxis
    // first, find all the div.code blocks
	document.querySelectorAll('div.zim-object pre code').forEach(el => {
		//el lenguaje de programación aparece el primero en la classlist
		let lang = el.classList[0];
  		// then highlight each
  		hljs.highlightElement(el,{language: lang});
	});


	//recorremos cada botón para el código que se ha generado.
	//el botón tiene un padre con el código (que es hermano del botón).
	document.querySelectorAll( "input.codigoboton").forEach( el =>{
	   let elemcodigo = el.parentElement.firstElementChild;
	   let resultado = el.parentElement.firstElementChild.nextElementSibling;
		el.addEventListener('click', e=>{ eval(elemcodigo.innerText); });
	});
   </script>
   <div id="pie">
   <p>Javier Mancera Fernández<br>
   <a href="https://www.twitch.tv/profesorinfo">https://www.twitch.tv/profesorinfo</a></p>
   </div>
</body>

</html>

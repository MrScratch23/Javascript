<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>8-2 Bases de datos</title>
	<meta name='Generator' content='Zim 0.75.1'>
	<style type='text/css'>
	    @import url('https://fonts.googleapis.com/css2?family=Montserrat&family=Jost&display=swap');
	    :root {
  			--html-background-color: #456;
  			--html-background-color-image: linear-gradient( 0deg, rgba(24,95,240,1) 16.4%, rgba(5,23,111,1) 70% );
  			
  			--main-color: #47b;
  			--main-background-color: #fff;
  			
  			--heading1-color-text: #eeffff;
  			--heading1-background-color: #47b;
  			--heading1-background-image: linear-gradient(to right, var(--main-color), #70bbdd);
  			
  			--code-color-text: #247;
  			
  			--input-background-color: #33a;
  			--input-background-color-hover: #44b

		}

	    html       { /*background-image: linear-gradient(#f2faff,#fff);*/
background-color: var(--html-background-color);
background-image: var(--html-background-color-image);
	    }
	    body       { font-family: 'Jost', 'Noto', 'Arial', 'Sans-serif';
	    				margin:0;
	                 }
	    div#contenido{
	    	margin: 0 auto; padding: 1rem; max-width: 90ch;
	    	background-color: var(--main-background-color);
	    	margin-bottom: 200px;
	    	border-bottom-right-radius: 100px;
			border-bottom: 5px solid darkblue;
			box-shadow: 0px 10px 10px -1px #1e90ff10, 
						  10px 30px 20px -1px #1e90ff40, 
						 -10px 30px 20px -1px #1e90ff40;			
	    }
	    input[type="button"]{
	                 background-color: var(--input-background-color);
                     color: white;
                     border-radius: 5px;
                     border: 3px solid #44b;
                     cursor: pointer;
                     padding: 0.5rem;
                     margin-left: 0.5rem;
                     margin-right: 0.5rem;
                     transition: margin-all 3s ease-in-out 3s;
        }
        input[type="button"]:hover{
	                 background-color: var(--input-background-color-hover);
        }
        input[type="button"]:active {
			  transform: translateY(2px);
			  cursor: progress;
		  }
		a,a:visited  { text-decoration: none;color:blue;      }
		a:hover    { text-decoration: underline; color: dodgerblue; }
		a:active   { text-decoration: underline }
		strike     { color: grey                }
		u          { text-decoration: none;
					 background-color: yellow   }
		tt         { color: var(--code-color-text);
				    	 font-size: large;
		             background-color: rgba(.99, .99, 1, 0.1); 
		           }
		pre        { color: var(--code-color-text);
		             background-color: rgba(.99, .99, 1, 0.1);
					 padding: 20px;
					 font-size: large;
				   }
		div.zim-object pre        {
		             background-color: white;
					 padding: 0px;
				   }				   
		h1         { font-family: 'Montserrat', 'Noto', 'Roboto', 'Arial', 'Sans-serif';
		             text-decoration: none;
					 /*color: #33a;
					 border-bottom: 5px dotted #33a;*/
					 /*margin-top: 2rem; 
					 margin-bottom: 1rem; 
					 
					 border-radius: 5px;
					 padding: 5px;
					 color: var(--heading1-color-text);
					 background-color: var(--heading1-background-color);
					 background-image: var(--heading1-background-image);
					 
					 font-size: xxx-large;*/
					font-family: 'Montserrat', 'Noto', 'Roboto', 'Arial', 'Sans-serif';
					text-decoration: none;
					margin-top: 2rem;
					margin-bottom: 2rem;
					border-radius: 2px;
					padding: 5px;
					color: var(--heading1-color-text);
					background-color: var(--heading1-background-color);
					background-image: linear-gradient(45deg, #0bb,#3fb,#78F);
					font-size: xxx-large;
					position: relative;
					z-index: 1;
					box-shadow: 5px 5px 0px 2px rebeccapurple;
				   }
	h1::before {
		  content: '';
		  position: absolute;
		  background-color: navy;
			transform: skewY(-8deg) rotate(7deg);
			top: -16px;
			left: 0;
			right: 0;
			bottom: 16px;
			z-index: -1; /*detrás del texto, pero delante del fondo */
	  }
		h2         { font-family: 'Montserrat', 'Noto', 'Roboto', 'Arial', 'Sans-serif';
		             color: var(--heading1-background-color); 
		             margin-bottom: 0.5rem;
		             margin-top: 1.5rem;
		             font-size: xx-large;
		             border-bottom: 2px solid var(--heading1-background-color);
		           }
		h3         { 
		             font-family: 'Montserrat', 'Noto', 'Roboto', 'Arial', 'Sans-serif';
		             color: var(--heading1-background-color); 
		             margin-bottom: 0.5rem;
		             margin-top: 1.5rem;
		             font-size: x-large;
		             font-style: italic;
		             margin-left: 0.5rem; 
		           }
		h4         { 
		             font-family: 'Montserrat', 'Noto', 'Roboto', 'Arial', 'Sans-serif';
		             color: var(--heading1-background-color); 
		             margin-bottom: 0.5rem;
		             margin-top: 1.5rem;
		             margin-left: 1rem;
		             filter: brightness(1.1);
		           }
		h5         { 
		             font-family: 'Montserrat', 'Noto', 'Roboto', 'Arial', 'Sans-serif';
		             color: var(--heading1-background-color);  
		             margin-bottom: 0.5rem; 
		             margin-top: 1.5rem;
		             filter: brightness(1.1);
		           }
		p          { margin-top: 0.25rem;  }
		span.zim-tag {
			color: #ce5c00;
		}
		img{
		    scale: 75%;
		    max-width:100%;
		    margin: 0 auto; /* para centrar las imágenes */
			 display: flex; /* para centrar las imágenes */
		}
		img:hover{
		    scale: 100%;
		    max-width:100%;
		}
		div.zim-object {
			border-style:solid;
			border-width:1px;
		}
		form{
            padding: 0.5rem;
            background-color: #125;
            border-radius: 0px;
            text-align: center;
            margin-bottom: 1rem;
		}
		ul{
		    list-style-type: '▪️ '; /*square*/
		}
		div#sumario{
            margin: 0 auto; 
            padding: 1rem; 
            max-width: 90ch;
            background-color: aquamarine; /*greenyellow;/*moccasin;*/
/*            background-image: radial-gradient( circle farthest-corner at 10% 20%,  rgba(166,239,253,1) 0%, rgba(97,186,255,1) 90.1% );
*/
				background-position:bottom;
				background-repeat: no-repeat;
				background-image: url('data:image/svg+xml, <svg preserveAspectRatio="none" viewBox="0 0 1200 120" xmlns="http://www.w3.org/2000/svg" style="fill: %23ffffff; width: 100%; height: 180px; transform: rotate(180deg);" ><path d="M321.39 56.44c58-10.79 114.16-30.13 172-41.86 82.39-16.72 168.19-17.73 250.45-.39C823.78 31 906.67 72 985.66 92.83c70.05 18.48 146.53 26.09 214.34 3V0H0v27.35a600.21 600.21 0 00321.39 29.09z" /></svg>');

            /*border-radius: 0px;*/
            border-top-right-radius: 152px;
		}
		div#sumario a {
			color:#0000dd;
		}
		div#sumario h1{
			margin-right: 300px;
			text-align: center;
			box-shadow: 5px 5px 0px 2px white;
		}
		div#volver{
		    position: fixed;
            right: 0.5rem;
            bottom: 0.5rem;
            padding: 0.5rem;
            border: 3px solid #7af;
            border-radius: 50%;
		}
		div#volver:hover {
			filter: brightness(1.2) saturate(1.2);
		}
		div#pie{
			min-height: 200px; 
			/*background-color: #47b;*/
			color: #cef;
			display: flex; 
			justify-content: center; 
			align-items: center; 
			position: fixed; 
			bottom:0; left:0; right: 0;
			z-index: -1;
			background-image: linear-gradient( 0deg, rgba(0,0,0,0.6) 0%, rgba(255,255,255,0) 100% );
			font-size: larger;
			text-align:center;
		}
		div#pie a{
			color: deepskyblue;
		}
		pre.codigo{
			border: 1px solid blue;
			padding: 5px;
			background-color: aliceblue;
			border-radius: 5px;
		}
		
		div.codigoresultado{
			background-color: #469;
			color: whitesmoke;
			padding: 5px;
			border-radius: 5px;
		}
		.checked-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB9gKGQ8sMEGsKGkAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAEBUlEQVRIx62V22tdRRTGf7Nn73P2ybntnNOe3NqkPTGgLTVUUZF6QatSLOKTPgqCIqLgQ0H/A1sQQbBYCBb1QfAxiC8tSO1FqHkwJVKtjdTGNraUmObsc9nXmfGh7cGYpM1D5nHWzPetteZb3wg2eB2YqYm4zSadsMtoboiNBH/3TE0awx6j+MRoxoTg/IYRvP19TQrJS0bzhdHGSyKFkLTtjSKwMjyiEz43ynhtP6bdjBCWyFobAf7eT7VhNF/q1FRbjYjmUohlCVPwnB+6FUxMTJipqSmUUhhjEGKd3bMT4ks/Y6oLBK2Yth8hHYtCJXOix7Nf7xLMzc0xOzvLzp078TyPNE3viW3QJPXzhNWbxFFKHCmMhoLn/FHodd48vGfhapdAacXQlkFK5dL6wIUm6fuTZPuvqDQhaMUYYyiVyuQr6rXDexYuAdi3tSv1ZJNs/R/CaszzT+1na88uXFnCEnJVgivBNN8uTJKmHQI/ptOOcXNZzMz9mOqFs90OHpipWcYwlo5P4ebnuOkrvr5wgrH+h3im7y36MzuwRXYZeKha/OhP0EkadFoxQSdGSotedR/+XwMc2XvKdNUFOFqZx6LKZWIiwjgkikNmLp/hm8sH+K1zjFTHXfBYdTi+eJArzXM0GxFxoBDCopLvo/fqEwi1XPkWkGqjFo2TgB1jOYZUKZTS/D1/ncmLh7jon0IbRWoiTi59ymzzJEEQE3cStNZsGxqlfPE57MBbOR8fP3hDGalOO9fq2DlBvmZw8xa2IxACGn6TydlD/O6f5OzSV/zif0cYhLQaEXGkKBbz7Ov/AOlXV1cxgBJRI3fuSTrpTawt18kWIZN1CFuaONI0w0WOXfsI43YIggh/KUSlhqxrMz74AkOZcWBm9QkH+Gw8NDLuITi+m0yzhluSyJzBLcpblUhFxywSRAEtPwQjsKVN30CNh0uvYuOubSHLtN3J0TO1j0pmBNuFbFWRK0gyPRZpktL2I5JQkclKakNlnh54g6ocvevUr/Ai2a7wineEkcJupA3S1Wg0nVZM2E6wbEF5U5G9Q++wI7sfR7h3N8HVNstykBfzH+KJEZwiWD0aIwxCgJ0R1Mu7GXOeJSuK93bZtQIle4D9pUNU5DC5jEsu55AvZakM5NicGyEj8uuz8bUCQgj67QfY671P3vEoeC69gy695U1U7NG7XV0pUwBjDJa1/JJlWWxzHuflzQe5FJ/GsgUVuZ2t8lEkTvfc0aNHb72flBhjVicQQqCUuvM3/M+WDVguWBrMVdDXEGZlBVEUrVCU9d9s5+fnaTQa2PZyPxEIhJaI1EEoZwX4ncynp6fXrmB4eJjR0VFarRbNZnP9P9rt9gohqNVq1Ov1ZbF/AZGev3hLJ2/zAAAAAElFTkSuQmCC)}
		.xchecked-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB9gKGQ8bDYnDxEwAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAEK0lEQVRIx9WVS2hTWRjHf/eR3CY1nbxMH2YiZRQS6qO13YlMVxY3SnVcuNIBFezGpSADLoQqLu1sHJCqdCFSXFpw4YOCSH3BtFqttTNamabX3DS5bfO6uffMoglja3RGcDMHzuac7/z/53++//cd+L8P6VuCPQYZ8ADNgBd4J31DcDcQs+GnHByRocEDv0kfBSjAOlYCs11Q+gpwDegS8LMJ+3QIK0ATzEhV8Odnz5bzw8P4dJ25aJQ/WlvJ1df/K7hSLtOcTNI+Pk69rpMTgqIQhCDvh1/VSpw79+gRrRMTmLZNezLJJsPg+a5dmOEwQlFqg1sWG16/Jv7sGWXDwBACFQjC9HcwIMONKkGp4PGAJGEDS0IQmZlhnWnye3c3eiyGo6qr3WHbrJ+dJf7gAXI6zSIr72T7/fgzmT4FHnTBsgrQBfYvTU0km5vxz86iADnAm0rRPTWFt7cXZccOJJcLAGHb2K9ekT93jmwmwwdAAFpjI6Ntbfxw5879ag7l6o1sr5eHHR3IsRgeQK/M4sQE+YEB7JcvEY6zAj45SWFgAPPxYwzHoQxIkQjTPT0kIxE+Noj8sexFn4/xnh58iQTeSpHkHAdrbIzi0BCOrmNPTpK/eJHM3bt8sCyKQCiR4NWePWSiUZw1+ZLXJm4pFKLhzBlCsRh2RUXacVgeGaF47RrL58+zcP8+RrmMkCQinZ1EL1zAjERqmkH+tLYl1G3bCJw4QUjT0IA0MJfLMX/5MqmHD0nZNiUgtGULG/r7ccXjINWuWbnmqsuFu7sb/4EDNLlcBIEioNs2KUAFGmMxmk6dQm1tRZI+3xBqEkiShBQOox05Ql1nJ26gvuIUAWiKQnj/ftStW5Fk+YuF+NldsbBA4cYN9KdPmaso8Fc62ZJtk7l1C2t0FGdxESHE1xE4hkHh6lX0oSHSpRIewC/LrPf7CSgKNpCamkI/fZr8pUuIZBIcpyaBunahPp1mub+fDyMjGKUSChCsq6Nh717q9u2jbnSU0uAgRrFIwTThyhUCqRS+hgZKLS1fJvDm87SNjZGcnsYUAjcQ8vsJ9/Xh7u1FDgRQN20iks3iDA+zZFmYhQLqzZtsj8WY3L0baY2Sf55ICCKpFHUzM2SEQAJCHg+hY8fQDh5EDgRWDoRC1J88SePRo2geD0XAcBy8b98Sv3ePYDZbbf2rFQjLIphMsmDbaEBQVQkePox26BCSz7e6i4bDrDt+nGYhmBscpFAskheC4Js3bPR4qHphFYEnlcI7P4/jdqNpGu8TCe4oCsXr1z//F2ga3+/cSfTJE0qmSVYIsKzaOZDcbjKyzFIiwfvt21kMBLA07YsetzWNd+3tLLW0sH5igvT8PH9Go/z44kX+E4LGjg7GDYOcy4XlOEgLC//5P/5LCFzxOPLmzWyIx+m6fduu7v0NVGqyTSycKksAAAAASUVORK5CYII=)}
		.unchecked-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB9gKGQ8qAt8h3m8AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAA60lEQVRIx+2VsQqDMBRF70sCLg5OLoKgjk7+lJ/hh+STXBwcnRz8ArMEkrxOFktbaC3tULzTg5e8k5vADXDq70VbobXmvu/hvQczg4heHrJfXxQFuq67blZbMc8zpmlCXddIkgTOuZcBUko45zCOI6y1Nz2xFSEEZFmGOI7fGg4A3nsQEZqmuXOu9jallACAtm3fvmutNaIoAjM/dkBECCF89KCbk4eAb+kEnIAT8EsAM0OIz3hSyrssUvss8t5fg+uIrLXPs0gIgWVZYIyBUurQyYdheO4gz3NUVQVjDNZ1PfSjpWmKsixvehfB9GBZ3NndrgAAAABJRU5ErkJggg==)}
		.migrated-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB+AKHREFA8vJSnkAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAC1klEQVRIx+2VT0hUURTGf/e958w4Tc3TYowMw1GyEgwr1MqsFmbZIrIWQZsWJUjbdoHQpl3Qps0swnCRECQFYkR/TC1iKkqmfzAKTo2Vf8hoRsfR995tkRMT87RRWkUHHhy495zvnvvu933wP/75EKkkEAjIYDCIaZpIKRFCZN0kfX9xcTGtra2/irVUEolECIfDlJeXo+s6hmFkDaCqKoZhEAqFSCaTv60pqcSyLAoLC/F4PEtqDmCaJkIIKisrMybX0sdUVRWA5ubmPzdNjjI1cpXkZC/O1fV03PXgdDqRUtpPIITAsqxsDz0Z/3CZQv8uqo4N4C8/Tp2/DdM0MiZQlvk41OTkI/LW1SGtCVb5drD3eCc71wcA+VcAHA5vDd8+3UGakxiJV7i9pdQevU5T1R35pJ3MV5QW1pf+0kWBheJ2SWua8EQXZXsu4fVVYEz1sEKvof5EuxjoPvzpcRvrdp9C2gGMx6cpOHBmbImMesds7BZubwMVDTfXDnQ3vQfK7AC8wLfExMX5whyQc3q2OEnjGm5vE76SQxsfBLr77a7CNf+n0r/l6sSMtsBSnurckiIILCobAtVZhpF4gZF4jubaymj4Ch/fd380LE7bAnjc0NPxk2yqpmEuwGxF0ag+0k5uTpzZeBeaazvj0We8fXojainsb2xh2BZgbe0gSIllzSIUh63wfQ6dZ/O2fbjcKlOj58jJ3cVENESw5yErc9nf2MLQ4jwQAkV1Lqiq37/cZ9WaahJjF9AcmxiPDhLs7ePe23oOnmUwg2hSShQle96tKDjA2HAniusgo9FxnvY9Jxw7RWzGYy92QghM00x5g53qp9sHmtB58/o2umOI2NwGolMnMYUHIb7aAyiKwsjICLqu2/qBEIKUUAohMaSHSLyBSMoPTINQ6CX5+fn2AEVFRZSUlBCPx4nFYhl3L4RESjF/GEgX3pSj+Xw+/H7/b3U/AEOZFnp7O5+5AAAAAElFTkSuQmCC)}
		ul {list-style-image: none}
		/* ul rule needed to reset style for sub-bullets */
	</style>
	
	<!-- resaltado de sintaxis -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
	<!-- and it's easy to individually load additional languages -->
	<!-- script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/php.min.js"></script -->


</head>
<body>
    <form>
    <input type="button" id="btnAmpliar" value="Ampliar margen">
    <input type="button" id="btnReducir" value="Reducir margen">
    <input type="button" id="btnSumario" value="Ver/ocultar sumario">
    </form>


<div id="sumario" style="display:none">
<h1>Sumario</h1>
<!-- Sumario --> 
            <a href="#h1">8-2 Bases de datos</a> <br>
            &nbsp; &nbsp; <a href="#h2">PDO</a> <br>
            &nbsp; &nbsp; <a href="#h3">Conexión a la base de datos</a> <br>
            &nbsp; &nbsp; <a href="#h4">Crear una tabla ejecutando una consulta</a> <br>
				&nbsp; &nbsp; &nbsp; &nbsp; Ejercicios <br>
        <!-- ocultamos el contenido entre ocultar y finocultar -->
            &nbsp; &nbsp; <a href="#h6">Ejecutar una consulta de eliminación, inserción o actualización</a> <br>
				&nbsp; &nbsp; &nbsp; &nbsp; Consultas con parámetros <br>
        <!-- ocultamos el contenido entre ocultar y finocultar -->
            &nbsp; &nbsp; <a href="#h8">Ejecutar una consulta de selección</a> <br>
				&nbsp; &nbsp; &nbsp; &nbsp; Limitando las consultas de selección <br>
        <!-- ocultamos el contenido entre ocultar y finocultar -->
            <a href="#h10">Ejercicios</a> <br>
            <a href="#h11">Ejercicio para entregar</a> <br>
</div>
<!-- Sumario -->


<div id="contenido">

<!-- contenido -->
			<h1 id="h1">8-2 Bases de datos</h1>
			<p>
Vamos a usar SQLite para trabajar con una base de datos. Veamos algunas características:
</p>
<ul style='padding-left: 30pt'>
<li>SQLite es la base de datos más usada del mundo con más de un billón de bases de datos en activo (un uno seguido de doce ceros)</li>
<li>Probablemente sea la pieza de software más desplegada del mundo, sólo por detrás de la biblioteca libzip y quizás la libpng</li>
<li>Es gratuita y de dominio público, cualquiera puede usarla y modificarla.</li>
<li>Se usa en navegadores web (Firefox, Chrome, Safari, Opera, etc.)</li>
<li>Se usa en todos multitud de sistemas operativos, incluyendo todos los Android, iOS, MacOS, Windows 10, Blackberry, WebOS, Tizen...</li>
<li>Se usa en aplicaciones populares como Skype, iTunes, Dropbox, Adobe Photoshop Elements, Adobe Lightroom, Adobe PDF Reader, Kodi, rpm (el gestor de paquetes de Fedora), Laravel, Drupal, Django, Ruby on Rails, Tomtom (GPS), Evernote, Proxmox ...</li>
<li>Permite gestionar bases de datos de hasta 2TB</li>
<li>PHP incluye soporte para SQLite por defecto desde la versión 5</li>
<li>Las bases de datos son autocontenidas en un único fichero</li>
<li>No requiere configuración</li>
<li>No permite crear usuarios a los que se le garantiza permisos, se apoya en los permisos que se establezcan en el sistema de ficheros</li>
<li>No es muy adecuada en sistemas en los que se prevean muchas escrituras (las escrituras concurrentes están muy limitadas), pero no hay problemas con múltiples lecturas concurrentes</li>
<li>Usa tipos dinámicos (realizará conversiones de tipos automáticas si son necesarias)</li>
<li>No permite crear vistas y sólo soporta <i>triggers</i> parcialmente</li>
</ul>
<br>
<p>
<b>Muy importante</b>: Para que Apache pueda crear ficheros y directorios sin tener problemas de permisos, debemos cambiar el propietario y el grupo propietario de los ficheros y directorios en los que queremos que pueda escribir. Como mínimo, debemos cambiar el grupo propietario del directorio actual para que sea <tt>www-data</tt> (el grupo de apache). Para ello, en el directorio donde queramos que apache pueda escribir ejecutaremos <tt>chown :www-data .</tt><br>
De hecho los ficheros que se crearán pertenecerán al usuario <tt>www-data</tt> y al grupo <tt>www-data</tt>.
</p>
<br>
<br>

			<h2 id="h2">PDO</h2>
			<p>
Vamos a utilizar los objetos PDO (PHP Data Object) para conectarnos a las bases de datos y gestionarlas. PDO ofrece una abstracción a la hora de conectarse y utilizar diferentes bases de datos, así se usarán las mismas funciones aunque la base de datos sea diferente y por tanto disminuyendo el acoplamiento entre el código y la base de datos.
</p>
<br>
<br>

			<h2 id="h3">Conexión a la base de datos</h2>
			<p>
Usaremos el siguiente código cuando vayamos a conectarnos a una base de datos MySQL:<br>
<tt>$conexion = new PDO( "mysql:host=$ip;dbname=$db",  $usuario,  $contraseña );</tt>
</p>
<br>
<p>
También podemos indicar la codificación de caracteres:<br>
<tt>$conexion = new PDO( 'mysql:host=localhost;dbname=tareas;charset=utf8',  "root",  "root" );</tt>
</p>
<br>
<p>
El código para una base de datos SQLite es aún más simple al no tener que indicar ni dirección ip, ni usuarios ni contraseñas.<br>
<tt>$conexion = new PDO( "sqlite:basedatos.db" );</tt>
</p>
<br>
<p>
Lo que haremos será crear una función en el fichero <tt>config.php</tt> que nos permita realizar la conexión al fichero que contiene la base de datos.
</p>
<pre>
function conectarBaseDatos( ){
	$doc_root = $_SERVER["DOCUMENT_ROOT"];
	$rutabd = $doc_root . "/basedatos/bd.sqlite";

	try {
		$conexion = new PDO("sqlite:".$rutabd);
	} catch (PDOException $e) {
		responderError( "No se ha podido establecer conexión con el servidor de bases de datos. \n " . $e-&gt;getMessage() );
		die ("Error: " . $e-&gt;getMessage());
	}

	return $conexion;
}
</pre>
<br>
<br>
<p>
Ahora podremos usar la conexión para realizar las consultas que deseemos. Por ejemplo, para crear una tabla.
</p>
<br>
<p>
<b>Importante</b>: recuerda que si un fichero sólo contiene código php debemos incluir el <tt>&lt;?php</tt>, <b>pero no el</b> <tt>?&gt;</tt> para evitar que se manden las nuevas cabeceras (por ejemplo si queremos hacer una redirección <tt>header('Location: ./inicio.php');</tt>, nos dará problemas porque ya fueron mandadas las cabeceras).
</p>
<br>
<br>

			<h2 id="h4">Crear una tabla ejecutando una consulta</h2>
			<p>
Para ejecutar consultas podemos usar una plantilla que tendremos que modificar para adaptarla a nuestras necesidades. Como ejemplo, vamos a crear una tabla en el fichero de base de datos que creamos en el anterior ejercicio. Si no lo tienes creado, hazlo ahora (asegúrate de que el directorio <tt>basedatos</tt> y el fichero  <tt>bd.sqlite</tt> pertenecen al usuario <tt>www-data</tt> y al grupo <tt>www-data</tt>).
</p>
<br>
<pre>
.
├── index.php
├── php
│    └── servidor.php
├── public/
│	    ├── css/
│	    └── js/
└── basedatos/
	    └── bd.sqlite
</pre>
<br>
<p>
Ahora podemos crear una tabla ejecutando este código en el servidor (el fichero podría llamarse <tt>crearTabla.php</tt>):
</p>
<pre>
&lt;?php
require( 'config.php');

// Creamos la conexión al servidor
$conexion = conectarBaseDatos();

// Recuperamos los parámetros de la petición
// $nombreTarea = $_POST["nombreTarea"];

$sql = "CREATE TABLE tareas (
	id INTEGER PRIMARY KEY AUTOINCREMENT, 
	nombre TEXT, 
	prioridad INTEGER DEFAULT 0
	);" ;

try{
	$resultado = $conexion-&gt;exec( $sql ); //Consultas de inserción, eliminación y actualización con exec. Selección con query
}catch(Exception $e){
	$resultado = null;
	$conexion = null;
	responderError( "Error al crear la tabla TAREAS. " . $e-&gt;getMessage());
	exit(0);
}

//cerramos la conexión
$resultado = null;
$conexion = null;

//mandamos la respuesta
responder("Tabla TAREAS creada con éxito.");
</pre>
<br>
<br>

            
				<h3>Ejercicios<a id="ejercicios" class="h_anchor"></a></h3>
<br>
<p>
<b>Ejercicio 2</b>: Añade un segundo botón que tenga como etiqueta <i>Crear tabla</i> y ejecute una llamada AJAX que llame al fichero <tt>crearTabla.php</tt> de arriba.
</p>
<br>
<br>
<br>
 <br>
			<h2 id="h6">Ejecutar una consulta de eliminación, inserción o actualización</h2>
			<p>
Las operaciones de inserción, borrado o actualización de datos sobre una tabla se realiza mediante <tt>exec()</tt>.
</p>
<br>
<pre>
$sql = "insert into tareas(nombre,completada) values ('Subir el Everest', 0)" ;
$resultado = $conexion-&gt;exec( $sql );
</pre>
<br>
<p>
Esa consulta es perfectamente válida porque los datos que vamos a insertar los estamos indicando nosotros manualmente. Sin embargo, si los datos que vamos a insertar provienen de datos escritos por un usuario, <b>hay que intentar prevenir los ataques de SQL injection</b>. Para ello, podemos usar consultas con parámetros.
</p>
<br>
<br>

            
				<h3>Consultas con parámetros<a id="consultas-con-parámetros" class="h_anchor"></a></h3>
<br>
<p>
Este tipo de consultas tiene la ventaja de que se pueden repetir en el tiempo, haciendo que la base de datos y el <i>driver</i> de conexión de PHP puedan cachear la consulta y hacer la ejecución más eficiente. Estas consultas preparadas se ejecutarán con <tt>execute()</tt>.
</p>
<br>
<p>
Código de ejemplo:
</p>
<pre>
$id = $_GET['id'];
$resultado = $conexion-&gt;prepare("SELECT * FROM tareas WHERE id&gt;=:id");
$resultado-&gt;execute([':id' =&gt; $id]);
</pre>
<br>
<br>
 <br>
			<h2 id="h8">Ejecutar una consulta de selección</h2>
			<p>
Las consultas de selección se hacen con el método <tt>query()</tt>, aunque al igual que con las anteriores habría que usar parámetros en las consultas para evitar ataques de inyección de SQL. 
</p>
<br>
<p>
Ejemplo de código con <tt>query()</tt>:
</p>
<pre>
$resultado = $conexion-&gt;query("SELECT * FROM tareas");

while ( $tarea = $resultado-&gt;fetchObject() ) {
	echo "&lt;p&gt;", $tarea-&gt;id ,": ", $tarea-&gt;nombre, " (", $tarea-&gt;prioridad ,")&lt;/p&gt;";
}
</pre>
<br>
<p>
En lugar de <tt>$resultado-&gt;fetchObject()</tt> podemos usar <tt>$resultado-&gt;fetch()</tt> que devolverá una tarea (una fila de la consulta) como un array asociativo.
</p>
<br>
<p>
<b>Nota</b>: También se puede, directamente, <tt>fetchAll()</tt> para recuperar todas las filas resultado de realizar la consulta.
</p>
<br>
<p>
Otra manera de hacerlo, en esta ocasión usando <tt>fetchAll()</tt>:
</p>
<pre>
$resultados = $resultado-&gt;fetchAll(); //devuelve un array

echo "&lt;p&gt;Hay un total de ",count($resultados)," tareas en la base de datos.&lt;/p&gt;";

foreach ($resultados as $tarea) {
	echo "&lt;p&gt;", $tarea['id'] ,": ", $tarea['nombre'], " (", $tarea['prioridad'] ,")&lt;/p&gt;";
}
</pre>
<br>
<p>
Salvo que indiquemos lo contrario, PHP por defecto se trae de la base de datos todas las filas de una vez, pero podemos procesarlas de una en una (<tt>fetchObject</tt>) o en un array asociativo (<tt>fetchAll</tt>).
</p>
<br>
<p>
Con el <tt>fetchAll()</tt> podemos contar las filas con un <tt>count( ... )</tt>. Sin embargo con el fetch tendremos que usar en un contador en el bucle.
</p>
<br>
<br>
<p>
Lo más cómodo para nosotros, si queremos mandar de vuelta todas las filas, será mandarlas todas de vuelta.<br>
<tt>responder($resultado-&gt;fetchAll()); //los manda todos de vuelta</tt>
</p>
<br>
<br>

            
				<h3>Limitando las consultas de selección<a id="limitando-las-consultas-de-selección" class="h_anchor"></a></h3>
<br>
<p>
Podemos limitar el número de registros obtenidos de las consultas selección usando las <tt>LIMIT</tt> y el <tt>OFFSET</tt> en la propia consulta.
</p>
<br>
<p>
Para limitar los resultados de la consulta, vamos a hacer uso de las palabras reservadas <tt>LIMIT</tt> y <tt>OFFSET</tt> de SQL y así podremos paginar los resultados. Podemos usarlos de la siguiente manera:
</p>
<br>
<pre>
SELECT * FROM tareas
LIMIT 10 OFFSET 30;
</pre>
<br>
<ul style='padding-left: 30pt'>
<li><tt>LIMIT</tt> indica cuántos resultados como máximo se devolverán en la consulta, en el caso de arriba se devolverán 10.</li>
<li><tt>OFFSET</tt> (que significa desplazamiento) indica cuántos elementos se ignorarán antes de empezar a devolverlos, en este caso 30.</li>
</ul>
<br>
<p>
De este modo nos devolverá los resultados que ocupen una posición entre la 31 y la 40 (10 resultados).
</p>
<br>
<br>
 <br>
			<h1 id="h10">Ejercicios</h1>
			<p>
<b>Ejercicio 3</b>: Termina la aplicación y haz que se puedan crear tareas, listarlas y eliminarlas. <br>
Acuérdate de usar parámetros para las consultas que vayas a ejecutar.
</p>
<br>
<p>
<b>Ejercicio 4 (ampliación)</b>: Completa la aplicación haciendo que se muestren las tareas paginadas de 5 en 5. Incluye botones al final del listado para avanzar o retroceder la página de resultados que se está mostrando.
</p>
<br>
<br>
<br>
<br>
<br>

			<h1 id="h11">Ejercicio para entregar</h1>
			<p>
Elegir uno de los propuestos.
</p>
<br>
<p>
<b>Ejercicio A</b>: Crea una aplicación web que permita mostrar anuncios de una serie de puestos de trabajo de una empresa. Los anuncios estarán almacenados en una base de datos y sólo un usuario autorizado (el usuario <tt>admin</tt> con clave <tt>Kilobyte1</tt>) podrá añadirlos y eliminarlos, el resto de los usuarios de la aplicación (incluyendo los no <i>logueados</i>) sólo podrán verlos.  Opcionalmente se puede añadir la funcionalidad de modificarlos.<br>
Los anuncios constarán de un título, una descripción y una lista de requisitos (por ejemplo tecnologías).
</p>
<br>
<p>
La funcionalidad, debe ser la siguiente:
</p>
<ul style='padding-left: 30pt'>
<li>En la página principal se mostrarán los anuncios que haya almacenados en la base de datos. Si no hay ninguno se mostrará un mensaje que indique que no hay puestos de trabajo disponibles.</li>
<li>En la página principal debe haber un formulario que permita hacer <i>login</i> en la aplicación (por ejemplo en un lateral o en una barra de navegación) o un enlace a una página que permita hacer <i>login</i> (en este caso, tras hacer el <i>login</i> correctamente se redirigirá a la página principal).</li>
<li>Si el usuario ha hecho <i>login</i> correctamente (nombre de usuario y contraseña correctos) se mostrarán los anuncios junto con un botón o mecanismo similar para eliminarlos. También aparecerá un formulario (por ejemplo al final o al principio de los anuncios) que permitirá añadir un nuevo anuncio.</li>
<li>Si el <i>login</i> se realizó correctamente, se recargará la página principal para que aparezca la funcionalidad de añadir y eliminar anuncios.</li>
<li>El <i>login</i> correcto o no se almacenará en el array de sesión del usuario.</li>
<li>La estética o organización de los elementos queda a elección del programador.</li>
</ul>
<br>
<br>
<br>
<p>
<b>Ejercicio B</b>: Crea una web que permita mostrar <i>post</i> de <i>microblogging</i> al estilo de twitter. Cada <i>post</i> se almacenará en una base de datos y contendrá un título, un mensaje, y opcionalmente un hiperenlace y una imagen (la URL de la imagen). Debe haber un usuario autorizado (el usuario <tt>admin</tt> con clave <tt>Kilobyte1</tt>) que podrá añadir los <i>post</i> y eliminarlos, el resto de los usuarios (incluyendo los usuarios no <i>logueados</i>) sólo podrán verlos. Opcionalmente se puede añadir la funcionalidad de modificarlos.
</p>
<br>
<p>
La funcionalidad, debe ser la siguiente:
</p>
<ul style='padding-left: 30pt'>
<li>En la página principal se mostrarán los últimos diez <i>posts</i> que haya almacenados en la base de datos. Si no hay ninguno se mostrará un mensaje que indique que no hay nada que mostrar.</li>
<li>En la página principal debe haber un formulario que permita hacer <i>login</i> en la aplicación (por ejemplo en un lateral o en una barra de navegación) o un enlace a una página que permita hacer <i>login</i> (en este caso, tras hacer el <i>login</i> correctamente se redirigirá a la página principal).</li>
<li>Si el usuario ha hecho <i>login</i> correctamente (nombre de usuario y contraseña correctos) se mostrarán los <i>posts</i> junto con un botón o mecanismo similar para eliminarlos. También aparecerá un formulario (por ejemplo al final o al principio de los <i>posts</i>) que permitirá añadir un nuevo <i>post</i>.</li>
<li>Si el <i>login</i> se realizó correctamente, se recargará la página principal para que aparezca la funcionalidad de añadir y eliminar <i>posts</i>.</li>
<li>El <i>login</i> correcto o no se almacenará en el array de sesión del usuario.</li>
<li>La estética o organización de los elementos queda a elección del programador.</li>
</ul>
<br>
<br>
<p>
<b>Ejercicio C</b>: Crea una aplicación web que permita gestionar un inventario de los ordenadores de un instituto.<br>
Debe permitir añadir y eliminar los siguientes datos de cada ordenador:
</p>
<ul style='padding-left: 30pt'>
<li>Nº de equipo (dato obligatorio)</li>
<li>Aula (dato obligatorio)</li>
<li>Procesador</li>
<li>RAM</li>
<li>MAC (dato obligatorio)</li>
</ul>
<br>
<p>
La funcionalidad, debe ser la siguiente:
</p>
<ul style='padding-left: 30pt'>
<li>Si el usuario no ha hecho <i>login</i> se mostrará una pantalla donde tendrá que <i>loguearse</i>. Si el <i>login</i> es incorrecto, se recargará la pantalla de <i>login</i> y se indicará que el usuario o la contraseña eran incorrectas. Si el <i>login</i> es correcto se redirigirá a una página de gestión.</li>
<li>El <i>login</i> correcto o no se almacenará en el array de sesión del usuario.</li>
<li>Si el usuario intenta acceder a la página de gestión y no se había hecho previamente el <i>login</i> de manera correcta, se redirigirá ala pantalla de <i>login</i>.  </li>
<li>En la página de gestión se mostrarán los ordenadores que haya almacenados en la base de datos. Si no hay ninguno se mostrará un mensaje que indique que no hay ningún ordenador que mostrar.</li>
<li>En la página de gestión debe haber junto a los ordenadores con un botón o mecanismo similar para eliminarlos. También aparecerá un formulario (por ejemplo al final o al principio de los ordenadores) que permitirá añadir un nuevo ordenador. Opcionalmente se puede añadir la funcionalidad de modificar los ordenadores.</li>
<li>La estética o organización de los elementos queda a elección del programador.</li>
</ul>
<br>





<!-- Wiki content -->

<!--
Lo separo con espacios entre el [ y el % para que no genere de nuevo el contenido
[ % FOR page IN pages % ]
	[ % page.content % ]
[ % END % ]
-->
<!-- End wiki content -->

</div>

<div id="volver">
    <a href="#">⬆️</a>
</div>

    <script defer>
    let ancho=90;
    btnAmpliar.addEventListener('click', e=>{
        ancho+=12;
        document.querySelector("#contenido").style.maxWidth = ancho+'ch';
        document.querySelector("#sumario").style.maxWidth = ancho+'ch';
    });
    btnReducir.addEventListener('click', e=>{
        ancho-=12;
        document.querySelector("#contenido").style.maxWidth = ancho+'ch';
        document.querySelector("#sumario").style.maxWidth = ancho+'ch';
    });
    
    let sumarioOculto = true;
    btnSumario.addEventListener('click', e=>{
        sumarioOculto = !sumarioOculto;
        if(sumarioOculto)document.querySelector("#sumario").style.display='none';
        else document.querySelector("#sumario").style.display='block'
    });
    
    
    //Resaltado de sintaxis
    // first, find all the div.code blocks
	document.querySelectorAll('div.zim-object pre code').forEach(el => {
		//el lenguaje de programación aparece el primero en la classlist
		let lang = el.classList[0];
  		// then highlight each
  		hljs.highlightElement(el,{language: lang});
	});


	//recorremos cada botón para el código que se ha generado.
	//el botón tiene un padre con el código (que es hermano del botón).
	document.querySelectorAll( "input.codigoboton").forEach( el =>{
	   let elemcodigo = el.parentElement.firstElementChild;
	   let resultado = el.parentElement.firstElementChild.nextElementSibling;
		el.addEventListener('click', e=>{ eval(elemcodigo.innerText); });
	});
   </script>
   <div id="pie">
   <p>Javier Mancera Fernández<br>
   <a href="https://www.twitch.tv/profesorinfo">https://www.twitch.tv/profesorinfo</a></p>
   </div>
</body>

</html>

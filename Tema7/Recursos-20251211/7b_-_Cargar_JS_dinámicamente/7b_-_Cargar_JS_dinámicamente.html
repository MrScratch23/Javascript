<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>7b - Cargar JS dinámicamente</title>
	<meta name='Generator' content='Zim 0.75.2'>
	<style type='text/css'>
	    @import url('https://fonts.googleapis.com/css2?family=Montserrat&family=Jost&display=swap');
	    :root {
  			--html-background-color: #456;
  			--html-background-color-image: linear-gradient( 0deg, rgba(24,95,240,1) 16.4%, rgba(5,23,111,1) 70% );
  			
  			--main-color: #47b;
  			--main-background-color: #fff;
  			
  			--heading1-color-text: #eeffff;
  			--heading1-background-color: #47b;
  			--heading1-background-image: linear-gradient(to right, var(--main-color), #70bbdd);
  			
  			--code-color-text: #247;
  			
  			--input-background-color: #33a;
  			--input-background-color-hover: #44b

		}

	    html       { /*background-image: linear-gradient(#f2faff,#fff);*/
background-color: var(--html-background-color);
background-image: var(--html-background-color-image);
	    }
	    body       { font-family: 'Jost', 'Noto', 'Arial', 'Sans-serif';
	    				margin:0;
	                 }
	    div#contenido{
	    	margin: 0 auto; padding: 1rem; max-width: 90ch;
	    	background-color: var(--main-background-color);
	    	margin-bottom: 200px;
	    	border-bottom-right-radius: 100px;
			border-bottom: 5px solid darkblue;
			box-shadow: 0px 10px 10px -1px #1e90ff10, 
						  10px 30px 20px -1px #1e90ff40, 
						 -10px 30px 20px -1px #1e90ff40;			
	    }
	    input[type="button"]{
	                 background-color: var(--input-background-color);
                     color: white;
                     border-radius: 5px;
                     border: 3px solid #44b;
                     cursor: pointer;
                     padding: 0.5rem;
                     margin-left: 0.5rem;
                     margin-right: 0.5rem;
                     transition: margin-all 3s ease-in-out 3s;
        }
        input[type="button"]:hover{
	                 background-color: var(--input-background-color-hover);
        }
        input[type="button"]:active {
			  transform: translateY(2px);
			  cursor: progress;
		  }
		a,a:visited  { text-decoration: none;color:blue;      }
		a:hover    { text-decoration: underline; color: dodgerblue; }
		a:active   { text-decoration: underline }
		strike     { color: grey                }
		u          { text-decoration: none;
					 background-color: yellow   }
		tt         { color: var(--code-color-text);
				    	 font-size: large;
		             background-color: rgba(.99, .99, 1, 0.1); 
		           }
		pre        { color: var(--code-color-text);
		             background-color: rgba(.99, .99, 1, 0.1);
					 padding: 20px;
					 font-size: large;
					 overflow-x: scroll;
				   }
		div.zim-object pre        {
		             background-color: white;
					 padding: 0px;
				   }				   
		h1         { font-family: 'Montserrat', 'Noto', 'Roboto', 'Arial', 'Sans-serif';
		             text-decoration: none;
					 /*color: #33a;
					 border-bottom: 5px dotted #33a;*/
					 /*margin-top: 2rem; 
					 margin-bottom: 1rem; 
					 
					 border-radius: 5px;
					 padding: 5px;
					 color: var(--heading1-color-text);
					 background-color: var(--heading1-background-color);
					 background-image: var(--heading1-background-image);
					 
					 font-size: xxx-large;*/
					font-family: 'Montserrat', 'Noto', 'Roboto', 'Arial', 'Sans-serif';
					text-decoration: none;
					margin-top: 2rem;
					margin-bottom: 2rem;
					border-radius: 2px;
					padding: 5px;
					color: var(--heading1-color-text);
					background-color: var(--heading1-background-color);
					background-image: linear-gradient(45deg, #0bb,#3fb,#78F);
					font-size: xxx-large;
					position: relative;
					z-index: 1;
					box-shadow: 5px 5px 0px 2px rebeccapurple;
				   }
	h1::before {
		  content: '';
		  position: absolute;
		  background-color: navy;
			transform: skewY(-8deg) rotate(7deg);
			top: -16px;
			left: 0;
			right: 0;
			bottom: 16px;
			z-index: -1; /*detrás del texto, pero delante del fondo */
	  }
		h2         { font-family: 'Montserrat', 'Noto', 'Roboto', 'Arial', 'Sans-serif';
		             color: var(--heading1-background-color); 
		             margin-bottom: 0.5rem;
		             margin-top: 1.5rem;
		             font-size: xx-large;
		             border-bottom: 2px solid var(--heading1-background-color);
		           }
		h3         { 
		             font-family: 'Montserrat', 'Noto', 'Roboto', 'Arial', 'Sans-serif';
		             color: var(--heading1-background-color); 
		             margin-bottom: 0.5rem;
		             margin-top: 1.5rem;
		             font-size: x-large;
		             font-style: italic;
		             margin-left: 0.5rem; 
		           }
		h4         { 
		             font-family: 'Montserrat', 'Noto', 'Roboto', 'Arial', 'Sans-serif';
		             color: var(--heading1-background-color); 
		             margin-bottom: 0.5rem;
		             margin-top: 1.5rem;
		             margin-left: 1rem;
		             filter: brightness(1.1);
		           }
		h5         { 
		             font-family: 'Montserrat', 'Noto', 'Roboto', 'Arial', 'Sans-serif';
		             color: var(--heading1-background-color);  
		             margin-bottom: 0.5rem; 
		             margin-top: 1.5rem;
		             filter: brightness(1.1);
		           }
		p          { margin-top: 0.25rem;  }
		span.zim-tag {
			color: #ce5c00;
		}
		img{
		    scale: 75%;
		    max-width:100%;
		    margin: 0 auto; /* para centrar las imágenes */
			 display: flex; /* para centrar las imágenes */
		}
		img:hover{
		    scale: 100%;
		    max-width:100%;
		}
		div.zim-object {
			border-style:solid;
			border-width:1px;
		}
		form{
            padding: 0.5rem;
            background-color: #125;
            border-radius: 0px;
            text-align: center;
            margin-bottom: 1rem;
		}
		ul{
		    list-style-type: '▪️ '; /*square*/
		}
		div#sumario{
            margin: 0 auto; 
            padding: 1rem; 
            max-width: 90ch;
            background-color: aquamarine; /*greenyellow;/*moccasin;*/
/*            background-image: radial-gradient( circle farthest-corner at 10% 20%,  rgba(166,239,253,1) 0%, rgba(97,186,255,1) 90.1% );
*/
				background-position:bottom;
				background-repeat: no-repeat;
				background-image: url('data:image/svg+xml, <svg preserveAspectRatio="none" viewBox="0 0 1200 120" xmlns="http://www.w3.org/2000/svg" style="fill: %23ffffff; width: 100%; height: 180px; transform: rotate(180deg);" ><path d="M321.39 56.44c58-10.79 114.16-30.13 172-41.86 82.39-16.72 168.19-17.73 250.45-.39C823.78 31 906.67 72 985.66 92.83c70.05 18.48 146.53 26.09 214.34 3V0H0v27.35a600.21 600.21 0 00321.39 29.09z" /></svg>');

            /*border-radius: 0px;*/
            border-top-right-radius: 152px;
		}
		div#sumario a {
			color:#0000dd;
		}
		div#sumario h1{
			margin-right: 300px;
			text-align: center;
			box-shadow: 5px 5px 0px 2px white;
		}
		div#volver{
		    position: fixed;
            right: 0.5rem;
            bottom: 0.5rem;
            padding: 0.5rem;
            border: 3px solid #7af;
            border-radius: 50%;
		}
		div#volver:hover {
			filter: brightness(1.2) saturate(1.2);
		}
		div#pie{
			min-height: 200px; 
			/*background-color: #47b;*/
			color: #cef;
			display: flex; 
			justify-content: center; 
			align-items: center; 
			position: fixed; 
			bottom:0; left:0; right: 0;
			z-index: -1;
			background-image: linear-gradient( 0deg, rgba(0,0,0,0.6) 0%, rgba(255,255,255,0) 100% );
			font-size: larger;
			text-align:center;
		}
		div#pie a{
			color: deepskyblue;
		}
		pre.codigo{
			border: 1px solid blue;
			padding: 5px;
			background-color: aliceblue;
			border-radius: 5px;
		}
		
		div.codigoresultado{
			background-color: #469;
			color: whitesmoke;
			padding: 5px;
			border-radius: 5px;
		}
		.checked-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB9gKGQ8sMEGsKGkAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAEBUlEQVRIx62V22tdRRTGf7Nn73P2ybntnNOe3NqkPTGgLTVUUZF6QatSLOKTPgqCIqLgQ0H/A1sQQbBYCBb1QfAxiC8tSO1FqHkwJVKtjdTGNraUmObsc9nXmfGh7cGYpM1D5nHWzPetteZb3wg2eB2YqYm4zSadsMtoboiNBH/3TE0awx6j+MRoxoTg/IYRvP19TQrJS0bzhdHGSyKFkLTtjSKwMjyiEz43ynhtP6bdjBCWyFobAf7eT7VhNF/q1FRbjYjmUohlCVPwnB+6FUxMTJipqSmUUhhjEGKd3bMT4ks/Y6oLBK2Yth8hHYtCJXOix7Nf7xLMzc0xOzvLzp078TyPNE3viW3QJPXzhNWbxFFKHCmMhoLn/FHodd48vGfhapdAacXQlkFK5dL6wIUm6fuTZPuvqDQhaMUYYyiVyuQr6rXDexYuAdi3tSv1ZJNs/R/CaszzT+1na88uXFnCEnJVgivBNN8uTJKmHQI/ptOOcXNZzMz9mOqFs90OHpipWcYwlo5P4ebnuOkrvr5wgrH+h3im7y36MzuwRXYZeKha/OhP0EkadFoxQSdGSotedR/+XwMc2XvKdNUFOFqZx6LKZWIiwjgkikNmLp/hm8sH+K1zjFTHXfBYdTi+eJArzXM0GxFxoBDCopLvo/fqEwi1XPkWkGqjFo2TgB1jOYZUKZTS/D1/ncmLh7jon0IbRWoiTi59ymzzJEEQE3cStNZsGxqlfPE57MBbOR8fP3hDGalOO9fq2DlBvmZw8xa2IxACGn6TydlD/O6f5OzSV/zif0cYhLQaEXGkKBbz7Ov/AOlXV1cxgBJRI3fuSTrpTawt18kWIZN1CFuaONI0w0WOXfsI43YIggh/KUSlhqxrMz74AkOZcWBm9QkH+Gw8NDLuITi+m0yzhluSyJzBLcpblUhFxywSRAEtPwQjsKVN30CNh0uvYuOubSHLtN3J0TO1j0pmBNuFbFWRK0gyPRZpktL2I5JQkclKakNlnh54g6ocvevUr/Ai2a7wineEkcJupA3S1Wg0nVZM2E6wbEF5U5G9Q++wI7sfR7h3N8HVNstykBfzH+KJEZwiWD0aIwxCgJ0R1Mu7GXOeJSuK93bZtQIle4D9pUNU5DC5jEsu55AvZakM5NicGyEj8uuz8bUCQgj67QfY671P3vEoeC69gy695U1U7NG7XV0pUwBjDJa1/JJlWWxzHuflzQe5FJ/GsgUVuZ2t8lEkTvfc0aNHb72flBhjVicQQqCUuvM3/M+WDVguWBrMVdDXEGZlBVEUrVCU9d9s5+fnaTQa2PZyPxEIhJaI1EEoZwX4ncynp6fXrmB4eJjR0VFarRbNZnP9P9rt9gohqNVq1Ov1ZbF/AZGev3hLJ2/zAAAAAElFTkSuQmCC)}
		.xchecked-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB9gKGQ8bDYnDxEwAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAEK0lEQVRIx9WVS2hTWRjHf/eR3CY1nbxMH2YiZRQS6qO13YlMVxY3SnVcuNIBFezGpSADLoQqLu1sHJCqdCFSXFpw4YOCSH3BtFqttTNamabX3DS5bfO6uffMoglja3RGcDMHzuac7/z/53++//cd+L8P6VuCPQYZ8ADNgBd4J31DcDcQs+GnHByRocEDv0kfBSjAOlYCs11Q+gpwDegS8LMJ+3QIK0ATzEhV8Odnz5bzw8P4dJ25aJQ/WlvJ1df/K7hSLtOcTNI+Pk69rpMTgqIQhCDvh1/VSpw79+gRrRMTmLZNezLJJsPg+a5dmOEwQlFqg1sWG16/Jv7sGWXDwBACFQjC9HcwIMONKkGp4PGAJGEDS0IQmZlhnWnye3c3eiyGo6qr3WHbrJ+dJf7gAXI6zSIr72T7/fgzmT4FHnTBsgrQBfYvTU0km5vxz86iADnAm0rRPTWFt7cXZccOJJcLAGHb2K9ekT93jmwmwwdAAFpjI6Ntbfxw5879ag7l6o1sr5eHHR3IsRgeQK/M4sQE+YEB7JcvEY6zAj45SWFgAPPxYwzHoQxIkQjTPT0kIxE+Noj8sexFn4/xnh58iQTeSpHkHAdrbIzi0BCOrmNPTpK/eJHM3bt8sCyKQCiR4NWePWSiUZw1+ZLXJm4pFKLhzBlCsRh2RUXacVgeGaF47RrL58+zcP8+RrmMkCQinZ1EL1zAjERqmkH+tLYl1G3bCJw4QUjT0IA0MJfLMX/5MqmHD0nZNiUgtGULG/r7ccXjINWuWbnmqsuFu7sb/4EDNLlcBIEioNs2KUAFGmMxmk6dQm1tRZI+3xBqEkiShBQOox05Ql1nJ26gvuIUAWiKQnj/ftStW5Fk+YuF+NldsbBA4cYN9KdPmaso8Fc62ZJtk7l1C2t0FGdxESHE1xE4hkHh6lX0oSHSpRIewC/LrPf7CSgKNpCamkI/fZr8pUuIZBIcpyaBunahPp1mub+fDyMjGKUSChCsq6Nh717q9u2jbnSU0uAgRrFIwTThyhUCqRS+hgZKLS1fJvDm87SNjZGcnsYUAjcQ8vsJ9/Xh7u1FDgRQN20iks3iDA+zZFmYhQLqzZtsj8WY3L0baY2Sf55ICCKpFHUzM2SEQAJCHg+hY8fQDh5EDgRWDoRC1J88SePRo2geD0XAcBy8b98Sv3ePYDZbbf2rFQjLIphMsmDbaEBQVQkePox26BCSz7e6i4bDrDt+nGYhmBscpFAskheC4Js3bPR4qHphFYEnlcI7P4/jdqNpGu8TCe4oCsXr1z//F2ga3+/cSfTJE0qmSVYIsKzaOZDcbjKyzFIiwfvt21kMBLA07YsetzWNd+3tLLW0sH5igvT8PH9Go/z44kX+E4LGjg7GDYOcy4XlOEgLC//5P/5LCFzxOPLmzWyIx+m6fduu7v0NVGqyTSycKksAAAAASUVORK5CYII=)}
		.unchecked-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB9gKGQ8qAt8h3m8AAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAA60lEQVRIx+2VsQqDMBRF70sCLg5OLoKgjk7+lJ/hh+STXBwcnRz8ArMEkrxOFktbaC3tULzTg5e8k5vADXDq70VbobXmvu/hvQczg4heHrJfXxQFuq67blZbMc8zpmlCXddIkgTOuZcBUko45zCOI6y1Nz2xFSEEZFmGOI7fGg4A3nsQEZqmuXOu9jallACAtm3fvmutNaIoAjM/dkBECCF89KCbk4eAb+kEnIAT8EsAM0OIz3hSyrssUvss8t5fg+uIrLXPs0gIgWVZYIyBUurQyYdheO4gz3NUVQVjDNZ1PfSjpWmKsixvehfB9GBZ3NndrgAAAABJRU5ErkJggg==)}
		.migrated-box {list-style-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABGdBTUEAALGPC/xhBQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAANOgAADMQBiN+4gQAAAAd0SU1FB+AKHREFA8vJSnkAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAC1klEQVRIx+2VT0hUURTGf/e958w4Tc3TYowMw1GyEgwr1MqsFmbZIrIWQZsWJUjbdoHQpl3Qps0swnCRECQFYkR/TC1iKkqmfzAKTo2Vf8hoRsfR995tkRMT87RRWkUHHhy495zvnvvu933wP/75EKkkEAjIYDCIaZpIKRFCZN0kfX9xcTGtra2/irVUEolECIfDlJeXo+s6hmFkDaCqKoZhEAqFSCaTv60pqcSyLAoLC/F4PEtqDmCaJkIIKisrMybX0sdUVRWA5ubmPzdNjjI1cpXkZC/O1fV03PXgdDqRUtpPIITAsqxsDz0Z/3CZQv8uqo4N4C8/Tp2/DdM0MiZQlvk41OTkI/LW1SGtCVb5drD3eCc71wcA+VcAHA5vDd8+3UGakxiJV7i9pdQevU5T1R35pJ3MV5QW1pf+0kWBheJ2SWua8EQXZXsu4fVVYEz1sEKvof5EuxjoPvzpcRvrdp9C2gGMx6cpOHBmbImMesds7BZubwMVDTfXDnQ3vQfK7AC8wLfExMX5whyQc3q2OEnjGm5vE76SQxsfBLr77a7CNf+n0r/l6sSMtsBSnurckiIILCobAtVZhpF4gZF4jubaymj4Ch/fd380LE7bAnjc0NPxk2yqpmEuwGxF0ag+0k5uTpzZeBeaazvj0We8fXojainsb2xh2BZgbe0gSIllzSIUh63wfQ6dZ/O2fbjcKlOj58jJ3cVENESw5yErc9nf2MLQ4jwQAkV1Lqiq37/cZ9WaahJjF9AcmxiPDhLs7ePe23oOnmUwg2hSShQle96tKDjA2HAniusgo9FxnvY9Jxw7RWzGYy92QghM00x5g53qp9sHmtB58/o2umOI2NwGolMnMYUHIb7aAyiKwsjICLqu2/qBEIKUUAohMaSHSLyBSMoPTINQ6CX5+fn2AEVFRZSUlBCPx4nFYhl3L4RESjF/GEgX3pSj+Xw+/H7/b3U/AEOZFnp7O5+5AAAAAElFTkSuQmCC)}
		ul {list-style-image: none}
		/* ul rule needed to reset style for sub-bullets */
	</style>
	
	<!-- resaltado de sintaxis -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
	<!-- and it's easy to individually load additional languages -->
	<!-- script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/php.min.js"></script -->


</head>
<body>
    <form>
    <input type="button" id="btnAmpliar" value="Ampliar margen">
    <input type="button" id="btnReducir" value="Reducir margen">
    <input type="button" id="btnSumario" value="Ver/ocultar sumario">
    </form>


<div id="sumario" style="display:none">
<h1>Sumario</h1>
<!-- Sumario --> 
            <a href="#h1">7b - Cargar JS dinámicamente</a> <br>
            <a href="#h2">Módulos en Javascript</a> <br>
            &nbsp; &nbsp; <a href="#h3">Modulos autónomos</a> <br>
            &nbsp; &nbsp; <a href="#h4">Módulos</a> <br>
				&nbsp; &nbsp; &nbsp; &nbsp; Importar todo el módulo <br>
        <!-- ocultamos el contenido entre ocultar y finocultar -->
				&nbsp; &nbsp; &nbsp; &nbsp; Importar con alias <br>
        <!-- ocultamos el contenido entre ocultar y finocultar -->
				&nbsp; &nbsp; &nbsp; &nbsp; Export default <br>
        <!-- ocultamos el contenido entre ocultar y finocultar -->
            <a href="#h8">Carga dinámica de un módulo</a> <br>
            &nbsp; &nbsp; <a href="#h9">El problema con la exportación por defecto</a> <br>
            <a href="#h10">Carga dinámica de un script</a> <br>
        
        
            <a href="#h13">Ejercicios</a> <br>
</div>
<!-- Sumario -->


<div id="contenido">

<!-- contenido -->
			<h1 id="h1">7b - Cargar JS dinámicamente</h1>
			<p>
Más información sobre módulos:
</p>
<ul style='padding-left: 30pt'>
<li><a href="https://developer.mozilla.org/es/docs/Web/JavaScript/Guide/Modules" title="https://developer.mozilla.org/es/docs/Web/JavaScript/Guide/Modules" class="https">https://developer.mozilla.org/es/docs/Web/JavaScript/Guide/Modules</a></li>
<li><a href="https://acrossverse.me/stories/how-javascript-modules-work" title="https://acrossverse.me/stories/how-javascript-modules-work" class="https">https://acrossverse.me/stories/how-javascript-modules-work</a></li>
</ul>
<br>
<br>

			<h1 id="h2">Módulos en Javascript</h1>
			<p>
Un módulo en Javascript es simplemente un fichero de código que será usado por otro fichero. Esta es el mecanismo moderno para dividir programas creados en Javascript en trozos que se pueden importar cuando sea necesario, de manera que el código pueda estar más organizado y ser más pequeño al poder cargar un módulo sólo cuando se vaya a usar de manera asíncrona.
</p>
<br>
<p>
<b>Importante</b>: necesitamos un servidor web para poder usar módulos y, además, un módulo sólo puede ser usado por otro módulo.
</p>
<br>
<br>

			<h2 id="h3">Modulos autónomos</h2>
			<p>
Son módulos que contienen código que será ejecutado inmediatamente sin interactuar con el resto del código. Cuando sean importados, se ejecutarán, realizarán alguna tarea y devolverán el control al módulo que los cargó.
</p>
<br>
<p>
No existe un término estándar para refereirse a este tipo de módulo, por lo que también podrían llamarse módulos autocontenidos, autoejecutables, autónomos o simplemente módulos aislados.
</p>
<br>
<p>
Por ejemplo, supongamos que tenemos una web con un <tt>&lt;input type="number" id="dato" value="79"&gt;</tt>. Esta web carga como módulo el fichero <tt>code.js</tt> que a su vez carga el módulo <tt>cuadrado.js</tt>:
</p>
<br>
<p>
Trozo del <tt>index.html</tt> (fíjate que se usa <tt>type="module"</tt> y no hay <tt>defer</tt>):
</p>
<pre>
...
  &lt;script type="module" src="code.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;h1&gt;Carga dinámica&lt;/h1&gt;
  &lt;input type="number" name="dato" id="dato" value="79"&gt;
  &lt;button type="button" id="btnAccion"&gt;Acción&lt;/button&gt;
...
</pre>
<br>
<p>
Fichero <tt>code.js</tt>:
</p>
<pre>
console.log("Probando las importaciones de un módulo autónomo");
alert("Bienvenido");

// importación del módulo cuadrado.js
import './saludo.js';

document.querySelector("#btnAccion").addEventListener("click", e=&gt;{
  console.log("Botón pulsado");
  cuadrado(7);
});
</pre>
<br>
<p>
Fichero de módulo <tt>cuadrado.js</tt>:
</p>
<pre>
console.info("Módulo cargado correctamente");
const cuadrado = n =&gt; n*n;
const valor = document.querySelector("#dato").value;
console.log(`El cuadrado de ${valor} es ${cuadrado(valor)}`);
</pre>
<br>
<p>
El resultado de la ejecución en la consola será el de la imagen de abajo:<br>
<img src="./7b_-_Cargar_JS_dinámicamente_files/pasted_image.png">
</p>
<br>
<p>
Cosas a tener en cuenta:
</p>
<ul style='padding-left: 30pt'>
<li>Desde el <tt>index.html</tt> se ha cargado el fichero <tt>code.js</tt> con <tt>&lt;script type="module" src="code.js"&gt;&lt;/script&gt;</tt>, porque <b>un módulo sólo puede ser cargado desde otro módulo.</b></li>
<li>El fichero <tt>code.js</tt> se carga sin usar el <tt>defer</tt>, este ya es el comportamiento por defecto de los módulos y no es necesario indicarlo.</li>
<li>Aunque cargues varias veces el mismo módulo, sólo será cargado y ejecutado una única vez.</li>
<li>El orden en el que se han ejecutado las operaciones no parece el intuitivo, <b>primero se ha ejecutado el módulo y luego el resto del código</b>. Esto es, sin embargo, el comportamiento esperado. En el parseado inicial del fichero <tt>code.js</tt>, el navegador <b>importa el módulo y lo ejecuta inmediatamente</b> antes de pasar a ejecutar el propio <tt>code.js</tt>.</li>
<li>Si pulsamos el botón, saldrá un error en la consola indicando que la funcioón <tt>cuadrado()</tt> no está definida, esa función sólo existe en el módulo <tt>cuadrado.js</tt></li>
<li>Por todo esto el uso de este tipo de módulos está muy limitado, pero podría usarse por ejemplo para que al acceder a la página principal se realizase una petición a un servidor que devolviera los 5 productos de oferta de la semana y los mostrase en la página.</li>
</ul>
<br>
<br>

			<h2 id="h4">Módulos</h2>
			<p>
Normalmente los módulos que vamos a utilizar no serán autónomos. Sino que se crearán para definir funciones o constantes que serán utilizados desde el fichero que los ha importado.
</p>
<br>
<p>
Por ejemplo, imagina este módulo definido en el fichero <tt>saludoModulo.js</tt>
</p>
<pre>
export function saludo(nombre){
  if(nombre)
    saludoNombre(nombre);
  else
    saludoNombre("");
}

export function saludoCaracola(){
  saludoNombre("caracola");
}

function saludoNombre(nombre){
  alert("Hola " + nombre);
}

export const nombreAutor = "Javier Mancera";
</pre>
<br>
<p>
La palabra clave <tt>export</tt> simplemente indica qué funciones serán utilizables desde fuera del módulo por el fichero que lo ha importado.
</p>
<br>
<p>
En lugar de indicar qué funciones o constantes se quieren exportar una a una, se puede indicar al final del módulo en una única instrucción <tt>export</tt>:
</p>
<pre>
export { saludo, saludoCaracola, nombreAutor };
</pre>
<br>
<p>
De una u otra forma, con <tt>export</tt> marcamos los componentes que queremos exportar desde nuestro módulo (no tenemos por qué exportar todo, podemos tener funciones auxiliares que no tienen por qué ser exportadas) y otro módulo podrá usarlo importándolo completo o importando sólo las funciones que le interese, por ejemplo:
</p>
<br>
<p>
Fichero <tt>code.js</tt>:
</p>
<pre>
import {saludo, saludoCaracola} from './saludoModulo.js';
saludo();
saludo("Javier");
saludoCaracola();
</pre>
<br>
<br>
<p>
Algunas cuestiones sobre los módulos:
</p>
<ul style='padding-left: 30pt'>
<li>Los módulos importados de esta manera, <b>serán evaluados inmediatamente</b>, lo que habrá que tenerlo en cuenta para mejorar la experiencia del usuario.</li>
<li>Los módulos siempre se ejecutan <b>en modo estricto</b>.</li>
<li>Los módulos <b>tiene su propio ámbito (scope)</b>, así que una variable definida globalmente en un módulo no se podrá usar en otro script a menos que sea exportada también (están aislados y encapsulan el código).</li>
<li>Un módulo <b>se evalúa una única vez</b> aunque se intente cargar varias veces.</li>
<li>Se ejecuta en diferido de la misma manera que un script cargado con <tt>defer</tt>.</li>
<li>Los módulos necesitan un servidor para ser cargados.</li>
<li>Un módulo exporta un objeto de exportación <tt>export { saludo, saludoCaracola, nombreAutor };</tt> que es usado en la importación.</li>
</ul>
<br>
<p>
Por estas razones, muchas bibliotecas de funciones se distribuyen en forma de módulos.
</p>
<br>
<br>

            
				<h3>Importar todo el módulo<a id="importar-todo-el-módulo" class="h_anchor"></a></h3>
<p>
Podemos importar todo el módulo en un objeto así:
</p>
<pre>
import * as saludos from './saludoModulo.js';

saludos.saludo( saludos.nombreAutor );
</pre>
<br>
<br>
 <br>
            
				<h3>Importar con alias<a id="importar-con-alias" class="h_anchor"></a></h3>
<pre>
import { saludo, saludoCaracola as holaCaracola } from './saludoModulo.js';

holaCaracola();
saludo();
</pre>
<br>
<br>
 <br>
            
				<h3>Export default<a id="export-default" class="h_anchor"></a></h3>
<p>
Podemos usar la palabra reservada <tt>default</tt> para definir una función o constante que se exportará por defecto.<br>
Podemos tener varias exportaciones en un módulo, pero <b>sólo una pueder ser la exportación por defecto</b>.
</p>
<br>
<pre>
function saludo(nombre){
  alert("Hola, " + nombre);
}
export default saludo;
</pre>
<br>
<p>
Y se usaría así (<b>sin llaves</b>):
</p>
<pre>
import saludo from './saludo.js';
saludo("Javier);
</pre>
<br>
<p>
También se puede aprovechar que vamos a importar sólo la exportación por defecto para cambiarle el nombre a uno que nos guste más:
</p>
<pre>
import hola from './saludo.js';
hola("Javier);
</pre>
<br>
<p>
También se pueden combinar exportaciones normales con una por defecto:
</p>
<pre>
export function saludo(nombre){
  if(nombre) saludoNombre(nombre);
  else saludoNombre("");
}

export default function saludoCaracola(){ // exportación por defecto
  saludoNombre("caracola");
}

function saludoNombre(nombre){
  alert("Hola " + nombre);
}

export const nombreAutor = "Javier Mancera";
</pre>
<br>
<p>
Y son cargadas por separado (además le cambiamos el nombre a la exportación por defecto):
</p>
<pre>
import decirHola, {nombreAutor} from './saludoModulo.js';
decirHola();
alert(`El autor: ${nombreAutor}`);
</pre>
<br>
<br>
 <br>
			<h1 id="h8">Carga dinámica de un módulo</h1>
			<p>
Los módulos son una manera conveniente de añadir funcionalida da una web, pero en cuanto al tiempo de carga de una web no se diferencia de los scripts cargados con <tt>defer</tt>.
</p>
<br>
<p>
Imaginemos que en nuestra web se muestra un conjunto de datos, por ejemplo una factura o las notas de unos alumnos, también tenemos un botón para convertir los datos a PDF y otro para crear una hoja de cálculo con los datos. Según las estadísticas de uso de la aplicación, los datos sólo <b>se convierten a PDF una de cada veinte veces</b> que se muestran. Y a una <b>hoja de cálculo sólo una de cada cuarenta veces</b> que se muestran. Además, rara vez se usan las dos funcionalidades en la misma sesión.
</p>
<br>
<p>
Tenemos un módulo o script que usamos para crear un PDF y otro que usamos para crear una hoja de cálculo. ¿Tiene sentido <b>cargar estos scripts siempre aunque el usuario no los use</b>? ¿Y sobre todo cargar los dos módulos aunque sólo se usará uno, si es que se llegan a usar? Probablemente no, estamos cargando bibliotecas pesadas y empeorando la experiencia normal del usuario por si acaso el usuario lo necesitase.
</p>
<br>
<p>
Una alternativa es <b>cargar estos módulos dinámicamente cuando se pulse un botón de exportar a PDF o a Hoja de cálculo</b>. Al ser módulos, la primera vez que se pulsen se realizará la carga del módulo, la segunda vez el sistema reconocerá que ya están cargados y no volverá a realizar la petición.
</p>
<br>
<p>
La carga dinámica de un módulo podría crearse usando el código de abajo. Se consigue usando la función <tt>import(ficheroModulo)</tt>. Esto cargará el módulo completo cuando se ejecute y devuelve una promesa.
</p>
<br>
<p>
Fichero <tt>code.js</tt>:
</p>
<pre>
const divResultado = document.querySelector("#divResultado");

document.querySelector("#btnAccion").addEventListener("click", async e=&gt;{
  try{
    let moduloSaludo = await import("./saludoModulo.js");
    moduloSaludo.saludo();
  }
  catch(error){
    divResultado.innerHTML = error +" Error al cargar la biblioteca";
  }
  
});
</pre>
<br>
<p>
<b>Nota</b>: El fichero code.js ahora no necesita ser un módulo.
</p>
<br>
<br>

			<h2 id="h9">El problema con la exportación por defecto</h2>
			<p>
Si recuerdas, en el módulo <tt>saludoModulo.js</tt> definíamos una función con <tt>export default function saludoCaracola()</tt>. A la hora de utilizarlo habrá que tenerlo en cuenta, porque esa funcion se exportará con el nombre de <tt>default</tt> y no como <tt>saludoCaracola</tt>.
</p>
<br>
<p>
Un ejemplo de uso sería el de abajo importando el módulo en un objeto <tt>moduloSaludo</tt> (fíjate que se usa <tt>moduloSaludo.default()</tt>):
</p>
<pre>
document.querySelector("#btnAccion").addEventListener("click", async e=&gt;{
  try{
    const moduloSaludo = await import("./saludoModulo.js");
    moduloSaludo.saludo();
    moduloSaludo.default(); // la función que se exporta por defecto
    console.log(moduloSaludo.nombreAutor);    
  }
  catch(error){
    divResultado.innerHTML = error +"&lt;p&gt;Error al cargar la biblioteca&lt;/p&gt;";
  }
});
</pre>
<br>
<p>
Otra manera sería la de abajo, usando una descomposición del objeto de exportación, el único problema es que la función por defecto se importaría como <tt>default</tt>, pero esta <b>es una palabra reservada</b> del lenguaje, por lo que se renombra con <tt>default:holaCaracola</tt>:
</p>
<pre>
document.querySelector("#btnAccion").addEventListener("click", async e=&gt;{
  try{
    const {saludo, default:holaCaracola, nombreAutor} = await import("./saludoModulo.js");
    saludo();
    holaCaracola();
    console.log(nombreAutor);
  }
  catch(error){
    divResultado.innerHTML = error +"&lt;p&gt;Error al cargar la biblioteca&lt;/p&gt;";
  }
});
</pre>
<br>
<br>
<br>

			<h1 id="h10">Carga dinámica de un script</h1>
			<p>
Si por alguna razón no queremos utilizar módulos (o no podemos por tener que dar soporte a navegadores antiguos o por ser una biblioteca que no usa módulos), también podemos realizar la carga dinámica de ficheros javascript usando métodos algo más silvestres.
</p>
<br>
<p>
<b>Nota</b>: algunas <i>build tools</i> como Vite pueden transpilar el código de los módulos en único fichero que navegadores antiguos pueden utilizar. Frameworks como React o Vue también lo hacen.
</p>
<br>
<p>
Supongamos que necesitamos cargar el código que está en el fichero <tt>biblioteca.js</tt>:
</p>
<pre>
"use strict";

function saludo(){
  console.log("Hola caracola");
}
const autor = "Javier Mancera";
</pre>
<br>
<p>
Fichero <tt>code.js</tt> con carga dinámica del fichero <tt>biblioteca.js</tt>:
</p>
<pre>
"use strict";

const cargarJS = (url , bibliotecaCargada) =&gt; {
  return new Promise(  (resolve, reject) =&gt;{
    // Comprobar si la biblioteca ya está cargada
    if (bibliotecaCargada) {
      resolve();
    } else {
    // Crear el elemento script
      var script = document.createElement('script');

      // Asignar la URL de la biblioteca SheetJS al atributo src del elemento script
      script.src = url;

      // Añadir un evento load que resuelve la promesa cuando la biblioteca está cargada
      script.addEventListener('load', resolve);
      script.addEventListener('error', reject);

      // Añadir el elemento script al documento
      document.body.appendChild(script);
    }
  });
}

// Variable cerrojo para saber si se cargó o no la biblioteca
let bibliotecaSaludoCargada = false;


document.querySelector("#btnCargarJS").addEventListener("click", async e=&gt;{
  try{
    await cargarJS("biblioteca.js", bibliotecaSaludoCargada );
    saludo();
    console.info("El autor es "+ autor);
    bibliotecaSaludoCargada = true;
  }
  catch(error){
    console.error("Error al cargar la biblioteca");
  }
});
</pre>
<br>
<p>
Fíjate que el script <tt>code.js</tt> no tiene que ser un módulo (por eso colocamos el <tt>use strict</tt>) y que aunque se pulse varias veces el botón de carga, no se añaden varias copias del fichero <tt>biblioteca.js</tt> al <tt>&lt;body&gt;</tt>. 
</p>
<br>
<p>
<img src="./7b_-_Cargar_JS_dinámicamente_files/pasted_image001.png">
</p>
<br>
<br>
<p>
<b>Tarea de ampliación</b>: en el código de arriba, es tarea del <tt>eventListener</tt> el llevar el control de si la biblioteca fue cargada mediante una variable cerrojo (<tt>bibliotecaSaludoCargada)</tt>. ¿Cómo podrías hacer que fuera la función <tt>cargarJS()</tt> la que llevara el control?
</p>
<br>
<br>

            
						<pre class="codigo">
Abajo puedes ver una pista para el ejercicio. Piénsalo antes de pulsar el botón.
							<div class="codigojs" style="display:none">let s = `&lt;p&gt;Pista: haz que en lugar de recibir dos variables, reciba un objeto con los datos de 
la biblioteca a cargar: la url y si ya se ha cargado o no.&lt;/p&gt;
&lt;p&gt;De esta manera podrás modificar desde la función la variable, porque al pasarse como 
parte de un objeto se pasará por referencia y no por valor.&lt;/p&gt;
&lt;p&gt;
// Variable cerrojo para saber si se cargó o no la biblioteca
let biblioteca = {
  bibliotecaCargada: false,
  url: "./biblioteca.js"
};
&lt;/p&gt;
`;
resultado.innerHTML=s;
									</div>
					<div class="codigoresultado"></div>
<input class="codigoboton" type="button" value="Ejecutar">
				</pre>
				
            
							<h1 id="h13">Ejercicios</h1>
			<p>
<b>Ejercicio 1:</b> Crea una web que contenga un <tt>&lt;input type="number" id="temperatura"&gt;</tt>, un botón y una división de resultado. Cuando se pulse el botón cargará dinámicamente un módulo que contendrá tres funciones, usará las funciones con el dato que el usuario haya escrito en el <tt>&lt;input&gt;</tt> e imprimirá el resultado en la división.
</p>
<br>
<p>
Las tres funciones del módulo serán las siguientes:
</p>
<ul style='padding-left: 30pt'>
<li><tt>celsiusAFahrenheit(temperatura)</tt></li>
<li><tt>fahrenheitACelsius(temperatura)</tt></li>
<li><tt>celsiusAKelvin(temperatura)</tt></li>
</ul>
<br>
<br>
<br>





<!-- Wiki content -->

<!--
Lo separo con espacios entre el [ y el % para que no genere de nuevo el contenido
[ % FOR page IN pages % ]
	[ % page.content % ]
[ % END % ]
-->
<!-- End wiki content -->

</div>

<div id="volver">
    <a href="#">⬆️</a>
</div>

    <script defer>
    let ancho=90;
    btnAmpliar.addEventListener('click', e=>{
        ancho+=12;
        document.querySelector("#contenido").style.maxWidth = ancho+'ch';
        document.querySelector("#sumario").style.maxWidth = ancho+'ch';
    });
    btnReducir.addEventListener('click', e=>{
        ancho-=12;
        document.querySelector("#contenido").style.maxWidth = ancho+'ch';
        document.querySelector("#sumario").style.maxWidth = ancho+'ch';
    });
    
    let sumarioOculto = true;
    btnSumario.addEventListener('click', e=>{
        sumarioOculto = !sumarioOculto;
        if(sumarioOculto)document.querySelector("#sumario").style.display='none';
        else document.querySelector("#sumario").style.display='block'
    });
    
    
    //Resaltado de sintaxis
    // first, find all the div.code blocks
	document.querySelectorAll('div.zim-object pre code').forEach(el => {
		//el lenguaje de programación aparece el primero en la classlist
		let lang = el.classList[0];
  		// then highlight each
  		hljs.highlightElement(el,{language: lang});
	});


	//recorremos cada botón para el código que se ha generado.
	//el botón tiene un padre con el código (que es hermano del botón).
	document.querySelectorAll( "input.codigoboton").forEach( el =>{
	   let elemcodigo = el.parentElement.firstElementChild;
	   let resultado = el.parentElement.firstElementChild.nextElementSibling;
		el.addEventListener('click', e=>{ eval(elemcodigo.innerText); });
	});
   </script>
   <div id="pie">
   <p>Javier Mancera Fernández<br>
   <a href="https://www.youtube.com/@Profesorinfo-x">https://www.youtube.com/@Profesorinfo-x</a></p>
   </div>
</body>

</html>
